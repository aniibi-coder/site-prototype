<!doctype html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ST9720GK2Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  
  gtag('config', 'G-ST9720GK2Y');
</script>
  <meta charset="utf-8" />
  
    <!-- ===== FAVICONS ===== -->
    <!-- ===== FAVICONS ===== -->
<link rel="icon" type="image/png" sizes="32x32" href="./assets/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./assets/icons/favicon-16x16.png">
<link rel="icon" href="./assets/icons/favicon.ico" sizes="any">
<link rel="apple-touch-icon" href="./assets/icons/apple-touch-icon.png">
<meta name="theme-color" content="#080d16">
<meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- ===================== SEO (edit me) ===================== -->
  <!-- SEO: Title shown in Google -->
  <title>Ridekit</title>

  <!-- SEO: Short description for Google snippet -->
  <meta name="description" content="Ridekit is a prototype that helps you explore ski & snowboard outfit recommendations based on mountain weather conditions. Pick a location, check forecast, and see a suggested layering setup.">

  <!-- SEO: Indexing rules -->
  <meta name="robots" content="index,follow">

  <!-- SEO: Canonical URL (update if you change domain/path) -->
  <link rel="canonical" href="https://ridekit.fr/">

  <!-- SEO: Open Graph (social sharing) -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="RIDEKIT.FR">
  <meta property="og:title" content="Ridekit ‚Äî Outfit selection helper">
  <meta property="og:description" content="Prototype: outfit recommendations for skiing & snowboarding based on weather and conditions.">
  <meta property="og:url" content="https://ridekit.fr/">
  <meta property="og:image" content="https://ridekit.fr/assets/icons/apple-touch-icon.png">

  <!-- SEO: Twitter card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Ridekit ‚Äî Outfit selection helper">
  <meta name="twitter:description" content="Prototype: outfit recommendations for skiing & snowboarding based on weather and conditions.">
  <meta name="twitter:image" content="https://ridekit.fr/assets/icons/apple-touch-icon.png">

  <!-- SEO: Structured data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "RIDEKIT.FR",
    "url": "https://ridekit.fr/"
  }
  </script>
  <!-- =================== /SEO (edit me) =================== -->

<!-- Favicon -->
<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <style>
/* ===== WINTER ALPINE DESIGN SYSTEM ===== */
:root{
  --bg: #eaf2ff;
  --bg2:#f7fbff;
  --text:#10223a;
  --muted:#4a607a;
  --card: rgba(255,255,255,.58);
  --card2: rgba(255,255,255,.40);
  --stroke: rgba(255,255,255,.65);
  --shadow: 0 18px 60px rgba(15,34,58,.14);
  --shadow2: 0 10px 30px rgba(15,34,58,.10);
  --primary:#2b6cff;
  --primary2:#3b86ff;
  --ice:#cfe5ff;
  --good:#1f9d57;
  --warn:#d18900;
  --bad:#c0392b;
  --radius: 18px;
  --radius2: 26px;
  --glassBlur: 14px;
  --max: 1200px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }

body{
  margin:0;
  color:var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
  background:
    radial-gradient(1200px 600px at 30% 0%, rgba(255,255,255,.70), rgba(255,255,255,0) 55%),
    radial-gradient(900px 500px at 80% 10%, rgba(207,229,255,.75), rgba(207,229,255,0) 60%),
    linear-gradient(180deg, #d6e9ff 0%, #f7fbff 35%, #e9f2ff 100%);
  min-height:100vh;
  overflow-x:hidden;
}

/* Background image (assets/background/background.png) */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background-image:
    url("assets/background/background.png?v=1");
  background-size:cover;
  background-position:center top;
  opacity:.18;
  pointer-events:none;
  z-index:-2;
}

body::after{
  content:"";
  position:fixed;
  inset:0;
  background: radial-gradient(900px 420px at 50% 0%, rgba(255,255,255,.75), rgba(255,255,255,0) 70%);
  pointer-events:none;
  z-index:-1;
}
.font-pixel {
  font-family: 'Press Start 2P', monospace;
  letter-spacing: 1px;
}

/* ===== SNOWFALL ANIMATION ===== */
.snowfall {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 20; /* behind header/cards, above map tiles a bit */
  overflow: hidden;
  mix-blend-mode: screen;
  opacity: .7;
}

.snowflake {
  position: absolute;
  background: white;
  border-radius: 50%;
  opacity: 0;
  animation: fall linear infinite;
  filter: blur(.2px);
}

@keyframes fall {
  0% { opacity: 0; transform: translateY(-10vh) translateX(0) rotate(0deg); }
  10% { opacity: 1; }
  90% { opacity: 0.8; }
  100% { opacity: 0; transform: translateY(100vh) translateX(30px) rotate(360deg); }
}

/* ===== FADE IN ANIMATIONS ===== */
@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes slideInLeft { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

/* ===== HEADER (fixed, stays on top) ===== */
header {
      height: 64px;
      padding: 0 24px;
      border-bottom: 1px solid var(--line);

      /* ‚úÖ Always pinned to viewport (won't scroll with content) */
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      width: 100%;

      background: rgba(8, 13, 22, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      z-index: 10000;

      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 16px;
      animation: fadeIn 0.5s ease-out;
    }

.headerLeft { display:flex; align-items:center; gap:16px; min-width:0; }
.badge{
  font-size: 10px;
  color: var(--text-muted);
  border: 1px solid var(--line);
  padding: 6px 12px;
  border-radius: 999px;
  background: rgba(16, 24, 40, 0.5);
  backdrop-filter: blur(6px);
  display: inline-flex;
  align-items: center;
  gap: 6px;
  white-space:nowrap;
}

.headerNav{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}
.headerNav a{
  color: var(--text-muted);
  text-decoration:none;
  font-weight: 600;
  font-size: 13px;
  border: 1px solid var(--line);
  padding: 8px 16px;
  border-radius: 999px;
  background: rgba(16, 24, 40, 0.6);
  backdrop-filter: blur(8px);
  transition: all 0.3s ease;
  display:flex;
  align-items:center;
  gap:8px;
}
.headerNav a:hover{
  color: var(--text);
  background: rgba(30, 58, 95, 0.4);
  border-color: var(--line-light);
  transform: translateY(-2px);
}
.headerNav a.active{
  background: rgba(56, 189, 248, 0.15);
  border-color: rgba(56, 189, 248, 0.4);
  color: var(--ice);
  box-shadow: 0 0 20px rgba(56, 189, 248, 0.2);
}
.headerRight{ justify-self:end; }

    .langSwitch{
      display:flex;
      align-items:center;
      gap:6px;
      padding:6px 8px;
      border:1px solid var(--line);
      border-radius:999px;
      background: rgba(16, 24, 40, 0.55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .langIcon{
      font-size: 13px;
      color: var(--text-muted);
      margin-right: 2px;
      opacity: 0.9;
    }
    .langBtn{
      border:1px solid transparent;
      background: transparent;
      color: var(--text-muted);
      padding:6px 10px;
      border-radius:999px;
      font-size:11px;
      font-weight:800;
      letter-spacing:0.6px;
      cursor:pointer;
      transition: all 0.25s ease;
      font-family: inherit;
    }
    .langBtn:hover{
      color: var(--text);
      background: rgba(30, 58, 95, 0.35);
      border-color: var(--line-light);
      transform: translateY(-1px);
    }
    .langBtn.active{
      background: rgba(56, 189, 248, 0.15);
      border-color: rgba(56, 189, 248, 0.4);
      color: var(--ice);
      box-shadow: 0 0 15px rgba(56, 189, 248, 0.18);
    }
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%) translateY(10px);
      background: rgba(16, 24, 40, 0.92);
      border: 1px solid var(--line);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 14px;
      font-size: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease, transform .25s ease;
      z-index: 10000;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: var(--shadow-frost);
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }


@media (max-width: 768px){
  header{ height:auto; grid-template-columns: 1fr; padding: 12px 16px; gap:12px; }
  .headerLeft{ justify-content:center; flex-wrap:wrap; }
  .headerRight{ justify-self:center; }
}

/* ===== MAIN LAYOUT ===== */
.wrap{
  margin-top: 10px;

  padding-top: 80px; /* header space */
  min-height: 100vh;
  display:grid;
  grid-template-columns: 1.15fr 1fr;
  grid-template-rows: 400px auto auto;
  gap: 16px;
  padding: 80px 16px 16px;
  max-width: 1600px;
  margin: 0 auto;
  align-content:start;
}
@media (max-width: 1100px){
  .wrap{ grid-template-columns: 1fr; grid-template-rows: 300px auto auto auto; }
}

/* ===== CARDS ===== */
.card{
  background: var(--gradient-card);
  border: 1px solid var(--line);
  border-radius: 20px;
  padding: 20px;
  overflow:hidden;
  position:relative;
  transition: all 0.4s ease;
  min-height:0;
}
.card::before{
  content:'';
  position:absolute;
  inset:0;
  background: var(--gradient-aurora);
  opacity:0;
  transition: opacity 0.4s ease;
  pointer-events:none;
}
.card:hover::before{ opacity:1; }
.card:hover{
  border-color: var(--glass-border);
  transform: translateY(-2px);
  box-shadow: var(--shadow-glow);
}

.title{
  font-family: 'Press Start 2P', monospace;
  font-size: 14px;
  margin: 0 0 8px 0;
  color: var(--snow);
  text-shadow: 0 0 20px rgba(240, 249, 255, 0.3);
  letter-spacing: 1px;
  text-transform: uppercase;
}
.muted{ color: var(--text-muted); font-size: 13px; }
.hint{ font-size: 13px; color: var(--text-muted); line-height: 1.5; }
.row{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; align-items:center; }
.pill{
  border: 1px solid var(--line);
  border-radius: 999px;
  padding: 6px 14px;
  font-size: 12px;
  color: var(--text-muted);
  background: rgba(16, 24, 40, 0.6);
  backdrop-filter: blur(8px);
  white-space: nowrap;
  transition: all 0.3s ease;
  display:inline-flex;
  align-items:center;
  gap:6px;
}
.pill:hover{ border-color: var(--line-light); background: rgba(30, 58, 95, 0.4); }

.divider{
  height: 1px;
  background: linear-gradient(90deg, transparent 0%, var(--line) 50%, transparent 100%);
  margin: 16px 0;
}

/* ===== MAP ===== */
#mapCard{ grid-column:1; grid-row:1; padding:0; overflow:hidden; animation: fadeInUp .6s ease-out; }
#map{ width:100%; height:100%; border-radius: 20px; }
.leaflet-container{ background: var(--bg-secondary) !important; }

#mapCard { position: relative; }  /* –≤–∞–∂–Ω–æ: —è–∫–æ—Ä—å –¥–ª—è absolute */

.mapSearch{
  position: absolute;
  top: 0px;        /* <-- –¥–≤–∏–≥–∞–π –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑ */
  left: 5px;       /* <-- –¥–≤–∏–≥–∞–π –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ */
  z-index: 5000;    /* –≤—ã—à–µ –∫–∞—Ä—Ç—ã –∏ –º–∞—Ä–∫–µ—Ä–æ–≤ */
  display:flex;
  align-items:flex-start;
  gap: 10px;
  pointer-events: auto;
  margin: 0;        /* —É–±–∏—Ä–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
}

.mapSearchBtn{
  width:44px; height:44px;
  border-radius:14px;
  border: 1px solid rgba(8,25,54,.12);
  background: rgba(255,255,255,.72);
  color:#0a1b33;
  backdrop-filter: blur(10px);
  box-shadow: 0 12px 30px rgba(0,0,0,.10);
  cursor:pointer;
}
.mapSearchBtn:hover{
  background: rgba(255,255,255,.92);
  border-color: rgba(8,25,54,.18);
  transform: scale(1.05);
}
.mapSearchPanel{
  width: min(360px, calc(100vw - 100px));
  border: 1px solid var(--line);
  border-radius: 16px;
  background: rgba(16, 24, 40, 0.9);
  backdrop-filter: blur(20px);
  overflow:hidden;
  box-shadow: var(--shadow-frost);
  animation: slideInLeft .3s ease-out;
}
.mapSearchPanel input{
  width:100%;
  border:0;
  outline:none;
  padding: 14px 16px;
  font-size:14px;
  color: var(--text);
  background: transparent;
  font-family: inherit;
}
.mapSearchPanel input::placeholder{ color: var(--text-dim); }
.mapSearchResults{
  max-height: 280px;
  overflow:auto;
  border-top: 1px solid var(--line);
}
.mapSearchItem{
  padding: 12px 16px;
  cursor:pointer;
  border-top: 1px solid rgba(30, 58, 95, 0.5);
  transition: all .2s ease;
}
.mapSearchItem:first-child{ border-top:none; }
.mapSearchItem:hover{ background: rgba(56, 189, 248, 0.1); }
.mapSearchItem b{ display:block; font-size:13px; color: var(--text); font-weight:600; }
.mapSearchItem span{ display:block; margin-top:4px; font-size:12px; color: var(--text-muted); }
.mapSearch.collapsed .mapSearchPanel{ display:none; }

/* ===== INFO CARD ===== */
#infoCard{
  grid-column:2; grid-row:1;
  padding:0;
  display:flex;
  flex-direction:column;
  animation: fadeInUp .6s ease-out .1s backwards;
}
@media (max-width: 1100px){
  #infoCard{ grid-column:1; grid-row:2; height:auto; }
}

.infoHero{
  position:relative;
  height: 130px;
  background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg) 100%);
  overflow:hidden;
  border-bottom: 1px solid var(--line);
  flex: 0 0 auto;
}
.infoHero .bg{
  position:absolute;
  inset:0;
  background-size: cover;
  background-position:center;
  filter: blur(8px) brightness(.7);
  transform: scale(1.1);
  opacity: .8;
  transition: all .6s ease;
}
.infoHero .overlay{
  position:absolute;
  inset:0;
  background: linear-gradient(to bottom, rgba(8, 13, 22, 0.2) 0%, rgba(8, 13, 22, 0.9) 100%);
}
.infoHeroContent{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  padding: 16px 20px;
  z-index:2;
}
.infoHeroTopRow{ display:flex; justify-content:space-between; align-items:flex-end; gap:12px; }
.infoHeroTitle{
  margin:0;
  font-size: 18px;
  color: var(--snow);
  text-shadow: 0 4px 20px rgba(0,0,0,.5);
  letter-spacing: .5px;
}
.infoHeroSub{ margin-top: 4px; color: rgba(234,244,255,.7); font-size: 13px; text-shadow: 0 4px 20px rgba(0,0,0,.5); }
.infoBody{ padding: 16px 20px; overflow:auto; flex: 1 1 auto; }

#datePick{
  background: rgba(16, 24, 40, 0.6);
  border: 1px solid var(--line);
  color: var(--text);
  padding: 8px 12px;
  border-radius: 12px;
  outline:none;
  font-family: inherit;
  cursor:pointer;
  transition: all .3s ease;
}
#datePick:hover, #datePick:focus{
  border-color: var(--ice);
  background: rgba(56, 189, 248, 0.1);
}

/* ===== DAILY STRIP ===== */
.dailyRow{
  display:flex;
  gap:10px;
  overflow-x:auto;
  padding: 8px 4px;
  margin-top: 12px;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
}
.dayCard{
  flex: 0 0 auto;
  width: 88px;
  border: 1px solid var(--line);
  border-radius: 14px;
  padding: 10px 8px;
  background: rgba(16, 24, 40, 0.5);
  cursor:pointer;
  user-select:none;
  text-align:center;
  scroll-snap-align:start;
  transition: all .3s ease;
}
.dayCard:hover{ background: rgba(30, 58, 95, 0.4); border-color: var(--line-light); transform: translateY(-3px); }
.dayCard.active{ border-color: rgba(56,189,248,.5); background: rgba(56,189,248,.12); box-shadow: 0 0 20px rgba(56,189,248,.2); }
.dayName{ font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: .5px; }
.dayEmoji{ font-size: 22px; margin-top: 6px; filter: drop-shadow(0 2px 4px rgba(0,0,0,.3)); }
.dayTemps{ font-size: 11px; margin-top: 6px; color: var(--text-muted); }
.dayTemps b{ font-size: 13px; color: var(--text); }

/* ===== METRIC BUTTONS ===== */
.seg{ display:flex; gap: 6px; margin-top: 12px; }
.seg button{
  flex:1;
  background: rgba(16, 24, 40, 0.5);
  border: 1px solid var(--line);
  color: var(--text-muted);
  padding: 8px 10px;
  border-radius: 12px;
  font-weight: 600;
  font-size: 11px;
  cursor:pointer;
  transition: all .3s ease;
  font-family: inherit;
}
.seg button:hover{ background: rgba(30, 58, 95, 0.4); border-color: var(--line-light); }
.seg button.active{
  background: rgba(56,189,248,.15);
  border-color: rgba(56,189,248,.4);
  color: var(--ice);
  box-shadow: 0 0 15px rgba(56,189,248,.2);
}

/* ===== HOURLY ===== */
.hourlyWrap{ margin-top: 16px; border-top: 1px solid var(--line); padding-top: 16px; animation: fadeIn .4s ease-out; }
.hourlyChart{
  width:100%; height: 80px;
  border: 1px solid var(--line);
  border-radius: 14px;
  background: rgba(16, 24, 40, 0.4);
  overflow:hidden;
  margin-top: 12px;
}
.hourlyRow{ margin-top: 12px; display:flex; gap: 10px; overflow-x:auto; padding: 8px 4px; scroll-snap-type:x mandatory; -webkit-overflow-scrolling: touch; }
.hourCard{
  flex:0 0 auto;
  width: 100px;
  border: 1px solid var(--line);
  border-radius: 14px;
  padding: 12px;
  background: rgba(16, 24, 40, 0.5);
  scroll-snap-align:start;
  transition: all .3s ease;
}
.hourCard:hover{ background: rgba(30, 58, 95, 0.4); border-color: var(--line-light); transform: translateY(-2px); }
.hourTop{ display:flex; justify-content:space-between; align-items:center; gap:6px; }
.hourTime{ font-size: 11px; color: var(--text-muted); font-weight: 600; }
.hourEmoji{ font-size: 18px; }
.hourBig{ font-size: 20px; font-weight: 800; margin-top: 8px; color: var(--text); }
.hourMeta{ font-size: 11px; color: var(--text-muted); margin-top: 4px; line-height: 1.3; }

/* ===== OUTFIT CARD ===== */
#outfitCard{ grid-column: 1 / 3; grid-row: 2; animation: fadeInUp .6s ease-out .2s backwards; }
@media (max-width: 1100px){ #outfitCard{ grid-column:1; grid-row:3; } }

.outfitGrid{ margin-top: 16px; }
.avatarBox{
  border: 1px dashed var(--line);
  border-radius: 20px;
  padding: 20px;
  background: rgba(255,255,255,0.01);
}
.avatarLayout{
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  display:grid;
  grid-template-columns: minmax(340px, 1fr) 380px;
  gap: 24px;
  align-items:start;
}
@media (max-width: 900px){
  .avatarLayout{ grid-template-columns: 1fr; justify-items:center; }
}
.avatarRow{
  width:100%;
  max-width: 780px;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  gap: 16px;
}
@media (max-width: 640px){
  .avatarRow{ flex-direction:column; align-items:center; }
}
@media (max-width: 640px){
  :root{ --avatarStageScale: 0.4; }
}

.layerTabs{ display:flex; flex-direction:column; gap: 10px; padding-top: 8px; }
@media (max-width: 640px){ .layerTabs{ flex-direction:row; padding-top: 0; } }
.layerTabs button{
  width: 80px;
  padding: 12px 14px;
  font-size: 11px;
  font-weight: 700;
  border-radius: 14px;
  background: rgba(16, 24, 40, 0.6);
  border: 1px solid var(--line);
  color: var(--text-muted);
  cursor:pointer;
  transition: all .3s ease;
  font-family: inherit;
  text-transform: uppercase;
  letter-spacing: .5px;
}
.layerTabs button:hover{ background: rgba(30, 58, 95, 0.4); border-color: var(--line-light); }
.layerTabs button.active{
  background: rgba(56, 189, 248, 0.15);
  border-color: rgba(56, 189, 248, 0.4);
  color: var(--ice);
  box-shadow: 0 0 20px rgba(56, 189, 248, 0.2);
}

.avatarStage{
  position: relative;
  width: calc(715px * var(--avatarStageScale, 1));
  max-width: 100%;
  aspect-ratio: 715 / 1138;
  border-radius: 16px;
  overflow:hidden;
  background: radial-gradient(circle at 30% 10%, rgba(56, 189, 248, 0.08) 0%, rgba(139, 92, 246, 0.04) 50%, transparent 100%);
}
.avatarCanvas{
  position:absolute; inset:0;
  width: 715px; height: 1138px;
  transform-origin: 0 0;
  pointer-events:none;
}
.avatarCanvas img{
  position:absolute;
  width:auto; height:auto;
  pointer-events:none;
  transition: filter .4s ease;
  user-select:none;
}
.avatarCanvas img.tinted{
  filter: drop-shadow(0 0 15px rgba(74, 222, 128, 0.8)) drop-shadow(0 0 6px rgba(74, 222, 128, 0.5));
}

.checkCanvas{
  position:absolute; inset:0;
  width:715px; height:1138px;
  transform-origin: 0 0;
  pointer-events:none;
  z-index: 120;
}
.checkPin{
  position:absolute;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: 8px;
  pointer-events:auto;
  cursor:pointer;
  transition: transform .3s ease;
  user-select:none;
}
.checkPin:hover{ transform: scale(1.1); }
.checkPin.side-left{ transform: translateX(-100%); }
.checkPin.side-right{ transform: translateX(0%); }
.checkPin.side-left:hover{ transform: translateX(-100%) scale(1.1); }
.checkPin.side-right:hover{ transform: translateX(0%) scale(1.1); }

.checkTitle{
  font-size: 10px;
  color: var(--text);
  background: rgba(16, 24, 40, 0.8);
  border: 1px solid var(--line);
  padding: 4px 10px;
  border-radius: 999px;
  white-space:nowrap;
  backdrop-filter: blur(8px);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .5px;
}
.checkPin input[type="checkbox"]{
  width: 20px; height: 20px;
  cursor:pointer;
  accent-color: var(--green-glow);
}

.controlsWrap{
  width: 380px;
  max-width: 100%;
  border: 1px solid var(--line);
  border-radius: 20px;
  padding: 20px;
  background: rgba(16, 24, 40, 0.6);
  backdrop-filter: blur(12px);
}
.controlsHeader{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom: 16px; }
.controlsHeaderTitle{ font-size: 12px; color: var(--snow); text-shadow: 0 0 20px rgba(240,249,255,.3); font-weight: 800; }
.control{ margin-top: 16px; }
.control label{ display:flex; justify-content:space-between; align-items:center; font-size: 13px; color: var(--text-muted); }
input[type="range"]{
  width:100%;
  margin-top: 10px;
  height: 6px;
  border-radius: 3px;
  background: var(--line);
  -webkit-appearance:none;
  cursor:pointer;
      font-family: 'Press Start 2P', monospace;
    }
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--ice);
  box-shadow: 0 0 15px rgba(56,189,248,.5);
  transition: all .3s ease;
}
input[type="range"]::-webkit-slider-thumb:hover{
  transform: scale(1.2);
  box-shadow: 0 0 25px rgba(56,189,248,.7);
}
.kpi{ display:flex; gap: 10px; flex-wrap:wrap; margin-top: 16px; }

details.setBox{
  border: 1px solid var(--line);
  border-radius: 14px;
  padding: 14px;
  background: rgba(16, 24, 40, 0.4);
  margin-top: 12px;
  transition: all .3s ease;
}
details.setBox:hover{ border-color: var(--line-light); }
details.setBox[open]{ background: rgba(30, 58, 95, 0.2); }
details.setBox > summary{
  cursor:pointer;
  user-select:none;
  font-weight: 700;
  font-size: 12px;
  color: var(--text);
  list-style:none;
  outline:none;
  display:flex;
  align-items:center;
  gap: 10px;
}
details.setBox > summary::-webkit-details-marker{ display:none; }
details.setBox > summary::before{
  content:"‚ñ∏";
  color: var(--ice);
  font-size: 12px;
  transition: transform .3s ease;
}
details.setBox[open] > summary::before{ transform: rotate(90deg); }

.setList{ margin-top: 14px; }
.setItem{
  padding: 12px;
  border-top: 1px solid rgba(30, 58, 95, 0.5);
  transition: all .3s ease;
}
.setItem:first-child{ border-top:none; }
.setItem:hover{ background: rgba(30, 58, 95, 0.3); border-radius: 10px; }
.setItemTop{ display:flex; justify-content:space-between; gap:12px; align-items:baseline; }
.setItemTop b{ color: var(--text); font-size: 13px; }
.setFile{ color: var(--text-dim); font-size: 11px; font-family: monospace; }
.setDesc{ margin-top: 6px; color: var(--text-muted); font-size: 12px; line-height: 1.4; }

.setItem.checked{
  background: rgba(74, 222, 128, 0.08);
  border-radius: 12px;
  border-left: 3px solid var(--green-glow);
}
.setItem.checked b{ color: rgba(134,239,172,.98); }
.setItem.checked .setFile{ color: rgba(134,239,172,.7); }
.setItem.checked .setDesc{ color: rgba(187,247,208,.85); }

/* ===== LIST CARD ===== */
#listCard{ grid-column: 1 / 3; grid-row: 3; animation: fadeInUp .6s ease-out .3s backwards; overflow:visible; }
@media (max-width: 1100px){ #listCard{ grid-column:1; grid-row:4; } }

.item{
  display:grid;
  grid-template-columns: 100px 1fr 130px;
  gap: 16px;
  padding: 16px;
  border: 1px solid var(--line);
  border-radius: 16px;
  margin-top: 12px;
  align-items:center;
  transition: all .3s ease;
  background: rgba(16, 24, 40, 0.4);
}
.item:hover{
  border-color: var(--line-light);
  background: rgba(30, 58, 95, 0.3);
  transform: translateX(4px);
}
@media (max-width: 640px){
  .item{ grid-template-columns: 1fr; text-align:center; }
  .thumb{ margin: 0 auto; }
}
.thumb{
  width: 100px;
  height: 80px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: rgba(56, 189, 248, 0.05);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size: 28px;
}
.item h4{ margin:0 0 6px 0; font-size: 14px; color: var(--text); font-weight: 600; }
.item a{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 8px;
  padding: 12px 20px;
  border-radius: 14px;
  background: rgba(56, 189, 248, 0.15);
  border: 1px solid rgba(56, 189, 248, 0.35);
  color: var(--ice);
  text-decoration:none;
  font-weight: 700;
  font-size: 13px;
  transition: all .3s ease;
}
.item a:hover{
  background: rgba(56, 189, 248, 0.25);
  border-color: var(--ice);
  transform: translateY(-2px);
  box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
}


/* ===== CTA ===== */
#ctaCard{
  grid-column: 1 / 3;
  grid-row: 3;
  text-align: center;
  animation: fadeInUp .6s ease-out .35s backwards;
}
@media (max-width: 1100px){
  #ctaCard{ grid-column:1; grid-row:4; }
}
.ctaRow{ margin-top: 16px; display:flex; justify-content:center; }
.ctaBtn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 10px;
  padding: 16px 22px;
  border-radius: 16px;
  background: rgba(56, 189, 248, 0.18);
  border: 1px solid rgba(56, 189, 248, 0.45);
  color: var(--snow);
  text-decoration:none;
  font-size: 12px;
  line-height: 1.2;
  box-shadow: 0 0 30px rgba(56, 189, 248, 0.14);
  transition: all .25s ease;
}
.ctaBtn:hover{
  transform: translateY(-2px);
  background: rgba(56, 189, 248, 0.26);
  border-color: rgba(56, 189, 248, 0.7);
  box-shadow: 0 0 40px rgba(56, 189, 248, 0.22);
}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar{ width: 8px; height: 8px; }
::-webkit-scrollbar-track{ background: var(--bg-secondary); border-radius: 4px; }
::-webkit-scrollbar-thumb{ background: var(--line); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover{ background: var(--ice); }
  
    /* ===== FOOTER ===== */
    footer.siteFooter{
      margin-top: 18px;
      padding: 28px 16px;
      border-top: 1px solid var(--line);
      background: rgba(0,0,0,0.15);
    }
    .footerInner{
      max-width: 1600px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: 1.2fr 1fr 1fr;
      gap: 18px;
      align-items:start;
    }
    .footerBrand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
    }
    .footerDesc{
      margin-top:10px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
      max-width: 520px;
    }
    .footerCol h4{
      margin: 0 0 10px 0;
      font-size: 12px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(234,240,255,0.92);
      font-family: 'Press Start 2P', monospace;
    }
    .footerLinks{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .footerLinks a{
      color: rgba(159,176,208,0.95);
      text-decoration:none;
      font-size: 13px;
      width:max-content;
      border-bottom: 1px solid transparent;
      padding-bottom:2px;
    }
    .footerLinks a:hover{
      color: #eaf0ff;
      border-bottom-color: rgba(42,109,255,0.55);
    }
    .footerBottom{
      max-width: 1600px;
      margin: 18px auto 0 auto;
      padding-top: 14px;
      border-top: 1px solid rgba(36,48,74,0.7);
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:space-between;
      color: rgba(159,176,208,0.9);
      font-size: 12px;
    }
    @media (max-width: 900px){
      .footerInner{ grid-template-columns: 1fr; }
    }

  
    /* ===== OUTFIT LAYOUT EDITOR (DEV TOOL) ===== */
    .layoutEditor{
      margin-top: 14px;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      background: rgba(16, 24, 40, 0.38);
    }
    .layoutEditor summary{
      cursor:pointer;
      user-select:none;
      font-weight:800;
      font-size: 12px;
      color: var(--text);
      list-style:none;
      outline:none;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .layoutEditor summary::-webkit-details-marker{ display:none; }
    .layoutEditor summary::before{ content:"üõ†Ô∏è"; opacity:.9; }
    .layoutGrid{
      margin-top: 10px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items:end;
    }
    .layoutGrid .full{ grid-column: 1 / -1; }
    .layoutGrid label{
      display:block;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 6px;
      font-weight: 700;
      letter-spacing: .2px;
    }
    .layoutGrid select,
    .layoutGrid input[type="number"]{
      width:100%;
      border: 1px solid var(--line);
      background: rgba(16, 24, 40, 0.65);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      outline:none;
      font-family: inherit;
      transition: all .25s ease;
    }
    .layoutGrid select:focus,
    .layoutGrid input[type="number"]:focus{
      border-color: rgba(56, 189, 248, 0.55);
      box-shadow: 0 0 0 3px rgba(56,189,248,.08);
    }
    .layoutBtns{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .layoutBtns button{
      border: 1px solid var(--line);
      background: rgba(16, 24, 40, 0.55);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 800;
      cursor:pointer;
      transition: all .25s ease;
      font-family: inherit;
    }
    .layoutBtns button:hover{
      background: rgba(30, 58, 95, 0.35);
      border-color: var(--line-light);
      transform: translateY(-1px);
    }
    .layoutBtns button.primary{
      background: rgba(56, 189, 248, 0.15);
      border-color: rgba(56, 189, 248, 0.35);
      color: var(--ice);
    }
    .layoutHint{
      margin-top: 10px;
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.45;
    }
    .editMode .avatarCanvas{ pointer-events:auto; }
    .editMode .avatarCanvas .layoutEditor img{ pointer-events:auto; cursor: grab; }
    .editMode .avatarCanvas img.dragging{ cursor: grabbing; }


    /* ===== LAYOUT EDITOR (DEV) ===== */
    .layoutEditBtn{
      position: fixed;
      right: 18px;
      bottom: 18px;
      z-index: 10050;
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 0.5px;
      color: var(--text);
      background: rgba(16, 24, 40, 0.82);
      backdrop-filter: blur(12px);
      cursor: pointer;
      box-shadow: var(--shadow-frost);
      transition: all .25s ease;
    }
    .layoutEditBtn:hover{
      transform: translateY(-2px);
      border-color: rgba(56, 189, 248, 0.45);
      box-shadow: 0 0 22px rgba(56, 189, 248, 0.22);
    }

    .layoutEditPanel{
      position: fixed;
      right: 18px;
      bottom: 64px;
      width: min(420px, calc(100vw - 36px));
      border: 1px solid var(--line);
      border-radius: 18px;
      background: rgba(16, 24, 40, 0.92);
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow-frost);
      z-index: 10060;
      display: none;
      overflow: hidden;
      animation: fadeInUp .25s ease-out;
    }
    .layoutEditPanel.open{ display:block; }

    .layoutEditHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(30, 58, 95, 0.55);
      background: rgba(8, 13, 22, 0.35);
    }
    .layoutEditTitle{
      font-size: 12px;
      font-weight: 900;
      color: var(--snow);
      letter-spacing: 0.6px;
      text-transform: uppercase;
    }
    .layoutEditClose{
      width: 34px;
      height: 34px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(16, 24, 40, 0.55);
      color: var(--text);
      cursor: pointer;
      transition: all .2s ease;
    }
    .layoutEditClose:hover{
      border-color: rgba(56, 189, 248, 0.45);
      background: rgba(56, 189, 248, 0.12);
    }

    .layoutEditBody{ padding: 14px; }
    .layoutEditRow{ display:flex; flex-direction:column; gap:8px; }
    .layoutEditLabel{ font-size: 12px; color: var(--text-muted); font-weight: 700; }
    .layoutEditSelect, .layoutEditInput{
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(12, 18, 33, 0.55);
      color: var(--text);
      outline: none;
      font-family: inherit;
    }
    .layoutEditSelect:focus, .layoutEditInput:focus{
      border-color: rgba(56, 189, 248, 0.55);
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.12);
    }
    .layoutEditGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    .layoutEditField{ display:flex; flex-direction:column; gap:8px; }

    .layoutEditHint{
      margin-top: 12px;
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.45;
    }
    .layoutEditActions{
      display:flex;
      gap: 10px;
      margin-top: 12px;
    }
    .layoutEditActionBtn{
      flex:1;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(56, 189, 248, 0.35);
      background: rgba(56, 189, 248, 0.14);
      color: var(--ice);
      font-weight: 900;
      cursor: pointer;
      transition: all .2s ease;
    }
    .layoutEditActionBtn:hover{
      background: rgba(56, 189, 248, 0.22);
      border-color: rgba(56, 189, 248, 0.6);
      transform: translateY(-1px);
    }
    .layoutEditActionBtn.ghost{
      border-color: var(--line);
      background: rgba(16, 24, 40, 0.5);
      color: var(--text);
    }
    .layoutEditActionBtn.ghost:hover{
      border-color: var(--line-light);
      background: rgba(30, 58, 95, 0.3);
      transform: translateY(-1px);
    }


/* ===== Guided Journey hero ===== */
.pageHero{
  padding: 28px 18px 8px;
}
.pageHeroInner{
  max-width: var(--max);
  margin: 0 auto;
  text-align:center;
}
.pageTitle{
  margin: 18px 0 10px;
  font-size: clamp(38px, 5vw, 56px);
  letter-spacing: -.02em;
  line-height:1.05;
}
.pageSubtitle{
  margin: 0 auto;
  max-width: 60ch;
  color: var(--muted);
  font-size: 16px;
}


/* ===== Guided Journey glass system overrides ===== */
header{
  position: sticky;
  top: 0;
  z-index: 50;
  backdrop-filter: blur(var(--glassBlur));
  -webkit-backdrop-filter: blur(var(--glassBlur));
  background: rgba(255,255,255,.42) !important;
  border-bottom: 1px solid rgba(255,255,255,.55) !important;
}

header .badge{
  background: rgba(255,255,255,.55) !important;
  border: 1px solid rgba(255,255,255,.65) !important;
  color: var(--muted) !important;
}

header .logo{
  color: var(--text) !important;
}

/* Pills */
.pill, .chip, .tabBtn, .segmented button{
  border-radius: 999px !important;
}

/* Panels / cards */
.card, .panel, .box, .glass, .mapCard, .forecastCard, .pickerCard, .setupCard{
  background: var(--card) !important;
  border: 1px solid var(--stroke) !important;
  box-shadow: var(--shadow2) !important;
  backdrop-filter: blur(var(--glassBlur));
  -webkit-backdrop-filter: blur(var(--glassBlur));
}

h1,h2,h3{
  color: var(--text);
}

.small, .muted, .hint, .sub, .desc{
  color: var(--muted) !important;
}

.btnPrimary, button.primary, .primaryBtn{
  background: linear-gradient(180deg, var(--primary2), var(--primary));
  color: #fff !important;
  border: 1px solid rgba(0,0,0,.06) !important;
  box-shadow: 0 10px 24px rgba(43,108,255,.25);
}

.btnPrimary:hover, button.primary:hover, .primaryBtn:hover{ filter: brightness(1.03); }

/* Inputs */
input, select, textarea{
  background: rgba(255,255,255,.60) !important;
  border: 1px solid rgba(255,255,255,.75) !important;
  color: var(--text) !important;
}

/* Leaflet map should keep corners */
#map, .leaflet-container{
  border-radius: 16px;
}

/* Footer */
footer{
  background: rgba(255,255,255,.35) !important;
  border-top: 1px solid rgba(255,255,255,.55) !important;
}


/* === Guided Journey (light) overrides === */
:root{
  --gj-bg: #f3f7ff;
  --gj-ink: #0a1b33;
  --gj-ink2:#35516e;
  --gj-card: rgba(255,255,255,.72);
  --gj-card2: rgba(255,255,255,.58);
  --gj-stroke: rgba(8,25,54,.12);
  --gj-shadow: 0 18px 45px rgba(14, 31, 67, .16);
  --gj-radius: 20px;
}
html,body{background: var(--gj-bg) !important; color: var(--gj-ink) !important;}
body{
  background-image:
    radial-gradient(1200px 600px at 20% 0%, rgba(110,170,255,.22), transparent 55%),
    radial-gradient(900px 500px at 80% 10%, rgba(170,220,255,.22), transparent 55%),
    linear-gradient(180deg, rgba(255,255,255,.9), rgba(243,247,255,1) 65%);
}
/* header */
header{position: sticky !important; top: 0; z-index: 50; padding: 14px 18px !important;
  background: rgba(255,255,255,.62) !important; border-bottom: 1px solid var(--gj-stroke) !important;
  backdrop-filter: blur(14px);
}
header .logo{color: var(--gj-ink) !important;}
header .badge{background: rgba(255,255,255,.7) !important; border:1px solid var(--gj-stroke) !important; color: var(--gj-ink2) !important;}
header .navPills a, header .navPills button{background: rgba(255,255,255,.66) !important; border:1px solid var(--gj-stroke) !important; color: var(--gj-ink) !important;}
header .navPills a.active{background: rgba(84,150,255,.18) !important;}

/* layout */
.wrap{max-width: 1180px !important; margin: 0 auto !important; padding: 22px 18px 70px !important; display:block !important;}
.pageHero{max-width: 1180px; margin: 20px auto 18px; padding: 26px 18px 8px; text-align:center;}
.pageHero h1{font-size: clamp(38px, 4vw, 54px) !important; letter-spacing: -0.02em; color: var(--gj-ink) !important;}
.pageHero p{color: var(--gj-ink2) !important; font-size: 16px;}

.stepCard{background: var(--gj-card); border: 1px solid var(--gj-stroke); border-radius: var(--gj-radius);
  box-shadow: var(--gj-shadow); padding: 18px; margin: 16px 0; overflow:hidden;
}
.stepTop{display:flex; align-items:center; gap: 12px; flex-wrap:wrap; margin-bottom: 10px;}
.stepPill{display:inline-flex; align-items:center; gap: 8px; padding: 8px 12px; border-radius: 999px;
  background: rgba(84,150,255,.14); border: 1px solid rgba(84,150,255,.22); color: #164b8b; font-weight: 700;
}
.stepTitle{font-size: 22px; font-weight: 850; color: var(--gj-ink);}
.stepSub{color: var(--gj-ink2); margin: 6px 0 14px;}

.frostInner{background: var(--gj-card2); border:1px solid rgba(8,25,54,.10); border-radius: 16px; padding: 12px;}

.ctaRow{display:flex; justify-content:space-between; align-items:center; gap: 12px; flex-wrap:wrap; margin-top: 12px;}
.btnPrimary{appearance:none; border:1px solid rgba(28,77,140,.18); background: linear-gradient(180deg, rgba(49,133,255,.95), rgba(42,106,222,.95));
  color: #fff; border-radius: 14px; padding: 10px 14px; font-weight: 800; cursor:pointer; box-shadow: 0 10px 26px rgba(31,98,210,.28);
}
.btnPrimary:active{transform: translateY(1px)}
.btnGhost{appearance:none; border:1px solid var(--gj-stroke); background: rgba(255,255,255,.66); color: var(--gj-ink);
  border-radius: 14px; padding: 10px 14px; font-weight: 800; cursor:pointer;
}

.mapShell{height: 320px; border-radius: 14px; overflow:hidden; border: 1px solid rgba(8,25,54,.12);}
#map{height:100% !important; border-radius: 14px;}

.grid2{display:grid; grid-template-columns: 1.25fr .9fr; gap: 16px; align-items: start;}
@media (max-width: 980px){.grid2{grid-template-columns:1fr;}}

.miniCard{background: rgba(255,255,255,.62); border:1px solid var(--gj-stroke); border-radius: 16px; padding: 12px;}
.progressWrap{height: 12px; background: rgba(10,27,51,.10); border-radius: 999px; overflow:hidden; border:1px solid rgba(10,27,51,.10)}
.progressFill{height:100%; width: 40%; background: linear-gradient(90deg, rgba(90,206,140,1), rgba(255,210,92,1));}

/* soften old dark UI leftovers */
.panel, .card, .bigCard, .outfitCard, .ctaCard {background: transparent !important; border:none !important; box-shadow:none !important;}
footer{background: transparent !important; border-top: 1px solid var(--gj-stroke) !important;}
footer .footerCol h4, footer .mini{color: var(--gj-ink) !important;}
footer a, footer p{color: var(--gj-ink2) !important;}

/* snow overlay subtle */
.snowfall{opacity: .35 !important;}


/* --- Wallpaper override (ensures assets/background/background.png is visible) --- */
body::before, body::after{display:none !important;}
:root{--wallpaper-url: url("assets/background/background.png?v=1");}
body{
  min-height: 100vh;
  background: none !important;
  background-image:
    var(--wallpaper-url),
    radial-gradient(1100px 650px at 20% 10%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%),
    radial-gradient(900px 500px at 80% 0%, rgba(210,232,255,.45), rgba(210,232,255,0) 55%),
    linear-gradient(180deg, rgba(238,244,251,.72), rgba(238,244,251,.92));
  background-size: cover, auto, auto, auto;
  background-position: center top, center, center, center;
  background-repeat: no-repeat;
  background-attachment: fixed, fixed, fixed, fixed;
}


/* --- UI polish: map search + mini forecast pulse --- */
.mapSearch{
  position:absolute;
  top:14px;
  left:14px;
  z-index: 5000; /* above tiles/markers */
  display:flex;
  gap:10px;
  align-items:flex-start;
}
.mapSearchBtn{
  width:44px; height:44px;
  border-radius:14px;
  border: 1px solid rgba(255,255,255,.22);
  background: rgba(20,30,50,.35);
  color:#fff;
  backdrop-filter: blur(10px);
  box-shadow: 0 12px 30px rgba(0,0,0,.18);
  cursor:pointer;
}
.mapSearchPanel{
  width: 320px;
  max-width: min(360px, calc(100vw - 100px));
  padding:10px;
  border-radius:18px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(20,30,50,.32);
  backdrop-filter: blur(12px);
  box-shadow: 0 12px 30px rgba(0,0,0,.18);
}
.mapSearch input{
  width:100%;
  padding:10px 12px;
  border-radius:14px;
  border: 1px solid rgba(255,255,255,.18);
  outline:none;
  background: rgba(255,255,255,.9);
  color:#0a1b33;
  font-weight:700;
}
.mapSearchResults{
  margin-top:10px;
  max-height: 280px;
  overflow:auto;
  padding-right:4px;
}
.mapSearchItem{
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:center;
  padding:10px 10px;
  border-radius:14px;
  cursor:pointer;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.06);
  color:#fff;
}
.mapSearchItem:hover{
  background: rgba(255,255,255,.12);
  border-color: rgba(255,255,255,.14);
}
.mapSearchMeta{ opacity:.78; font-size:12px; font-weight:600; }
.mapSearch.collapsed .mapSearchPanel{ display:none; }

#forecastMini.pulseOnce{
  animation: pulseOnce .65s ease-out;
}
#weekBox.pulseOnce{animation: pulseOnce .65s ease-out;}
@keyframes pulseOnce{
  0%{ transform: translateY(0); box-shadow: 0 0 0 rgba(43,108,255,0); }
  40%{ transform: translateY(-2px); box-shadow: 0 14px 30px rgba(43,108,255,.18); }
  100%{ transform: translateY(0); box-shadow: 0 0 0 rgba(43,108,255,0); }
}


/* --- Weekly forecast collapsible --- */
.weekBox{
  margin-top: 12px;
  border: 1px solid var(--gj-stroke);
  border-radius: 16px;
  background: rgba(255,255,255,.62);
  box-shadow: 0 12px 28px rgba(14,31,67,.10);
  overflow:hidden;
}
.weekBox > summary{
  list-style:none;
  cursor:pointer;
  user-select:none;
  display:flex;
  align-items:center;
  gap:10px;
  padding: 12px 14px;
}
.weekBox > summary::-webkit-details-marker{ display:none; }
.weekChevron{ margin-left:auto; opacity:.7; transition: transform .2s ease; }
.weekBox[open] .weekChevron{ transform: rotate(180deg); }
.weekInner{ padding: 12px 14px 14px; border-top: 1px solid rgba(8,25,54,.10); }
.weekDays{ display:flex; gap:8px; flex-wrap:wrap; }
.weekDayBtn{
  appearance:none;
  border:1px solid rgba(8,25,54,.12);
  background: rgba(255,255,255,.72);
  border-radius: 14px;
  padding: 8px 10px;
  cursor:pointer;
  font-weight: 900;
}
.weekDayBtn:hover{ background: rgba(84,150,255,.14); border-color: rgba(84,150,255,.22); }
.weekDayBtn.active{ background: rgba(84,150,255,.18); border-color: rgba(84,150,255,.28); }
.weekDetailsBody{ margin-top: 10px; color: var(--gj-ink2); font-weight: 700; line-height:1.45; }


/* --- Weekly forecast (Google-like) --- */
.weekGrid{
  display:grid;
  grid-template-columns: repeat(8, minmax(0,1fr));
  gap:10px;
  margin-top: 14px;
}
@media (max-width: 900px){
  .weekGrid{ grid-template-columns: repeat(4, minmax(0,1fr)); }
}
.dayCard{
  border:1px solid rgba(8,25,54,.12);
  background: rgba(255,255,255,.72);
  border-radius: 16px;
  padding: 10px 10px 9px;
  cursor:pointer;
  text-align:center;
  font-weight: 900;
  user-select:none;
}
.dayCard:hover{ background: rgba(84,150,255,.14); border-color: rgba(84,150,255,.22); }
.dayCard.active{ background: rgba(84,150,255,.18); border-color: rgba(84,150,255,.28); box-shadow: 0 10px 20px rgba(14,31,67,.10); }
.dayName{ font-size: 12px; opacity:.75; font-weight: 900; letter-spacing: .2px; }
.dayIcon{ font-size: 18px; margin: 6px 0 2px; }
.dayTemps{ font-size: 13px; }
.dayTemps span{ opacity:.8; font-weight: 800; }

.weatherTop{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.weatherNowTemp{ font-size: 34px; font-weight: 950; line-height:1; }
.weatherNowMeta{ color: var(--gj-ink2); font-weight: 800; margin-top: 4px; }

.dayDetails{
  margin-top: 12px;
  border: 1px solid var(--gj-stroke);
  border-radius: 16px;
  background: rgba(255,255,255,.62);
  box-shadow: 0 12px 28px rgba(14,31,67,.10);
  overflow:hidden;
}
.dayDetails > summary{
  list-style:none;
  cursor:pointer;
  user-select:none;
  display:flex;
  align-items:center;
  gap:10px;
  padding: 12px 14px;
}
.dayDetails > summary::-webkit-details-marker{ display:none; }
.dayDetailsInner{ padding: 12px 14px 14px; border-top: 1px solid rgba(8,25,54,.10); }

.tabs{ display:flex; gap:8px; flex-wrap:wrap; }
.tabBtn{
  appearance:none;
  border:1px solid rgba(8,25,54,.12);
  background: rgba(255,255,255,.72);
  border-radius: 999px;
  padding: 8px 12px;
  cursor:pointer;
  font-weight: 900;
}
.tabBtn.active{ background: rgba(84,150,255,.18); border-color: rgba(84,150,255,.28); }

.chartWrap{ margin-top: 12px; }
.dayStats{ margin-top: 10px; color: var(--gj-ink2); font-weight: 800; line-height: 1.45; }


/* --- Weather header row (big temp + date picker) --- */
.weatherTopRow{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:14px;
}
.datePickWrap{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:6px;
  margin-top:6px;
}
.datePickLabel{
  font-size:12px;
  font-weight:900;
  letter-spacing:.02em;
  color: var(--gj-ink2);
  opacity:.85;
}
#datePicker{
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(8,25,54,.14);
  background: rgba(255,255,255,.9);
  font-weight:900;
  color:#0a1b33;
}




/* --- Light theme button unification (no !important) --- */
.headerNav a,
.seg button,
.layerTabs button,
.layoutBtns button,
.langSwitch,
.layoutEditBtn,
.layoutEditClose{
  background: rgba(255,255,255,.66);
  border: 1px solid var(--gj-stroke);
  color: var(--gj-ink);
}

.headerNav a:hover,
.seg button:hover,
.layerTabs button:hover,
.layoutBtns button:hover,
.layoutEditBtn:hover,
.layoutEditClose:hover{
  background: rgba(255,255,255,.90);
  border-color: rgba(8,25,54,.18);
}

.headerNav a.active,
.seg button.active,
.layerTabs button.active,
.layoutBtns button.primary{
  background: rgba(84,150,255,.18);
  border-color: rgba(84,150,255,.28);
  color: #164b8b;
  box-shadow: none;
}

.langIcon{ color: var(--gj-ink2); }

.langBtn{ color: var(--gj-ink2); }
.langBtn:hover{
  background: rgba(255,255,255,.85);
  border-color: rgba(8,25,54,.18);
  color: var(--gj-ink);
}
.langBtn.active{
  background: rgba(84,150,255,.18);
  border-color: rgba(84,150,255,.28);
  color: #164b8b;
  box-shadow: none;
}
</style>
  <link rel="preload" as="image" href="assets/background/background.png?v=1" />

<!-- === WALLPAPER FIX (AUTO-INJECTED) === -->
<style>
/* Force-enable wallpaper, override all previous rules */
html, body {
  min-height: 100% !important;
}

body::before,
body::after {
  display: none !important;
  content: none !important;
}

body {
  background-color: #eef3fb !important;
  background-image:
    url("assets/background/background.png"),
    radial-gradient(1100px 650px at 20% 10%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%),
    radial-gradient(900px 500px at 80% 0%, rgba(210,232,255,.45), rgba(210,232,255,0) 55%) !important;
  background-repeat: no-repeat !important;
  background-position: center top !important;
  background-size: cover !important;
  background-attachment: fixed !important;
}

/* Keep main layout above background WITHOUT touching Leaflet internals */
body > header,
body > main,
body > footer,
.pageHero,
.wrap,
.stepCard{
  position: relative;
  z-index: 1;
}

/* --- UI polish: map search + mini forecast pulse --- */
.mapSearch{
  position:absolute;
  top:14px;
  left:14px;
  z-index: 5000; /* above tiles/markers */
  display:flex;
  gap:10px;
  align-items:flex-start;
}
.mapSearchBtn{
  width:44px; height:44px;
  border-radius:14px;
  border: 1px solid rgba(8,25,54,.12);
  background: rgba(255,255,255,.72);
  color:#0a1b33;
  backdrop-filter: blur(10px);
  box-shadow: 0 12px 30px rgba(0,0,0,.10);
  cursor:pointer;
}
.mapSearchBtn:hover{
  background: rgba(255,255,255,.92);
  border-color: rgba(8,25,54,.18);
}
.mapSearchPanel{
  width: 320px;
  max-width: min(360px, calc(100vw - 100px));
  padding:10px;
  border-radius:18px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(20,30,50,.32);
  backdrop-filter: blur(12px);
  box-shadow: 0 12px 30px rgba(0,0,0,.18);
}
.mapSearch input{
  width:100%;
  padding:10px 12px;
  border-radius:14px;
  border: 1px solid rgba(255,255,255,.18);
  outline:none;
  background: rgba(255,255,255,.9);
  color:#0a1b33;
  font-weight:700;
}
.mapSearchResults{
  margin-top:10px;
  max-height: 280px;
  overflow:auto;
  padding-right:4px;
}
.mapSearchItem{
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:center;
  padding:10px 10px;
  border-radius:14px;
  cursor:pointer;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.06);
  color:#fff;
}
.mapSearchItem:hover{
  background: rgba(255,255,255,.12);
  border-color: rgba(255,255,255,.14);
}
.mapSearchMeta{ opacity:.78; font-size:12px; font-weight:600; }
.mapSearch.collapsed .mapSearchPanel{ display:none; }

#forecastMini.pulseOnce{
  animation: pulseOnce .65s ease-out;
}
#weekBox.pulseOnce{animation: pulseOnce .65s ease-out;}
@keyframes pulseOnce{
  0%{ transform: translateY(0); box-shadow: 0 0 0 rgba(43,108,255,0); }
  40%{ transform: translateY(-2px); box-shadow: 0 14px 30px rgba(43,108,255,.18); }
  100%{ transform: translateY(0); box-shadow: 0 0 0 rgba(43,108,255,0); }
}


/* --- Weekly forecast collapsible --- */
.weekBox{
  margin-top: 12px;
  border: 1px solid var(--gj-stroke);
  border-radius: 16px;
  background: rgba(255,255,255,.62);
  box-shadow: 0 12px 28px rgba(14,31,67,.10);
  overflow:hidden;
}
.weekBox > summary{
  list-style:none;
  cursor:pointer;
  user-select:none;
  display:flex;
  align-items:center;
  gap:10px;
  padding: 12px 14px;
}
.weekBox > summary::-webkit-details-marker{ display:none; }
.weekChevron{ margin-left:auto; opacity:.7; transition: transform .2s ease; }
.weekBox[open] .weekChevron{ transform: rotate(180deg); }
.weekInner{ padding: 12px 14px 14px; border-top: 1px solid rgba(8,25,54,.10); }
.weekDays{ display:flex; gap:8px; flex-wrap:wrap; }
.weekDayBtn{
  appearance:none;
  border:1px solid rgba(8,25,54,.12);
  background: rgba(255,255,255,.72);
  border-radius: 14px;
  padding: 8px 10px;
  cursor:pointer;
  font-weight: 900;
}
.weekDayBtn:hover{ background: rgba(84,150,255,.14); border-color: rgba(84,150,255,.22); }
.weekDayBtn.active{ background: rgba(84,150,255,.18); border-color: rgba(84,150,255,.28); }
.weekDetailsBody{ margin-top: 10px; color: var(--gj-ink2); font-weight: 700; line-height:1.45; }


/* --- Weekly forecast (Google-like) --- */
.weekGrid{
  display:grid;
  grid-template-columns: repeat(8, minmax(0,1fr));
  gap:10px;
  margin-top: 14px;
}
@media (max-width: 900px){
  .weekGrid{ grid-template-columns: repeat(4, minmax(0,1fr)); }
}
.dayCard{
  border:1px solid rgba(8,25,54,.12);
  background: rgba(255,255,255,.72);
  border-radius: 16px;
  padding: 10px 10px 9px;
  cursor:pointer;
  text-align:center;
  font-weight: 900;
  user-select:none;
}
.dayCard:hover{ background: rgba(84,150,255,.14); border-color: rgba(84,150,255,.22); }
.dayCard.active{ background: rgba(84,150,255,.18); border-color: rgba(84,150,255,.28); box-shadow: 0 10px 20px rgba(14,31,67,.10); }
.dayName{ font-size: 12px; opacity:.75; font-weight: 900; letter-spacing: .2px; }
.dayIcon{ font-size: 18px; margin: 6px 0 2px; }
.dayTemps{ font-size: 13px; }
.dayTemps span{ opacity:.8; font-weight: 800; }

.weatherTop{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.weatherNowTemp{ font-size: 34px; font-weight: 950; line-height:1; }
.weatherNowMeta{ color: var(--gj-ink2); font-weight: 800; margin-top: 4px; }

.dayDetails{
  margin-top: 12px;
  border: 1px solid var(--gj-stroke);
  border-radius: 16px;
  background: rgba(255,255,255,.62);
  box-shadow: 0 12px 28px rgba(14,31,67,.10);
  overflow:hidden;
}
.dayDetails > summary{
  list-style:none;
  cursor:pointer;
  user-select:none;
  display:flex;
  align-items:center;
  gap:10px;
  padding: 12px 14px;
}
.dayDetails > summary::-webkit-details-marker{ display:none; }
.dayDetailsInner{ padding: 12px 14px 14px; border-top: 1px solid rgba(8,25,54,.10); }

.tabs{ display:flex; gap:8px; flex-wrap:wrap; }
.tabBtn{
  appearance:none;
  border:1px solid rgba(8,25,54,.12);
  background: rgba(255,255,255,.72);
  border-radius: 999px;
  padding: 8px 12px;
  cursor:pointer;
  font-weight: 900;
}
.tabBtn.active{ background: rgba(84,150,255,.18); border-color: rgba(84,150,255,.28); }

.chartWrap{ margin-top: 12px; }
.dayStats{ margin-top: 10px; color: var(--gj-ink2); font-weight: 800; line-height: 1.45; }


/* --- Weather header row (big temp + date picker) --- */
.weatherTopRow{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:14px;
}
.datePickWrap{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:6px;
  margin-top:6px;
}
.datePickLabel{
  font-size:12px;
  font-weight:900;
  letter-spacing:.02em;
  color: var(--gj-ink2);
  opacity:.85;
}
#datePicker{
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(8,25,54,.14);
  background: rgba(255,255,255,.9);
  font-weight:900;
  color:#0a1b33;
}


/* --- Skill buttons active state --- */
[data-skill].active{
  background: rgba(84,150,255,.18) !important;
  border-color: rgba(84,150,255,.34) !important;
  box-shadow: 0 10px 24px rgba(43,108,255,.14);
}

</style>

</head>

<body>
  <img src="assets/background/background.png?v=1" alt="" style="position:absolute; width:1px; height:1px; opacity:0; pointer-events:none;" aria-hidden="true" />
  <div class="snowfall" id="snowfall" aria-hidden="true"></div>
 <header>
  <div class="headerLeft">
    <a class="logo" href="index.html" style="text-decoration:none;"><span class="logo-icon">üèîÔ∏è</span><span class="font-pixel" style="font-weight:900;">RIDEKIT.FR</span></a>
    <div class="badge">MVP ‚Ä¢ one page ‚Ä¢ Leaflet</div>
  </div>

  <nav class="headerNav" aria-label="Pages">
    <a href="index.html" data-page="home">Map</a>
    <a href="gear.html" data-page="gear">Gear finder</a>
  </nav>

  <div class="headerRight">
    <div class="langSwitch" role="group" aria-label="Language selector">
      <span class="langIcon" aria-hidden="true">üåê</span>
      <button class="langBtn active" type="button" data-lang="en" aria-label="English">EN</button>
      <button class="langBtn" type="button" data-lang="fr" aria-label="Fran√ßais">FR</button>
      <button class="langBtn" type="button" data-lang="ru" aria-label="–†—É—Å—Å–∫–∏–π">RU</button>
      <button class="langBtn" type="button" data-lang="de" aria-label="Deutsch">DE</button>
    </div>
  </div>
</header>

  
  
<section class="pageHero">
  <h1>Plan your ride</h1>
  <p>Answer the questions below, and we‚Äôll get you set up for your next trip.</p>
</section>

<main class="wrap" id="main">

  <section class="stepCard" id="step-destination">
    <div class="stepTop">
      <div class="stepPill">Step 1</div>
      <div class="stepTitle">Destination</div>
    </div>
    <div class="stepSub">Where will you be riding?</div>

    <div class="frostInner">
      <div style="display:flex; align-items:center; gap:10px; color:var(--gj-ink2); font-weight:700; margin-bottom:10px;">
        <span style="font-size:16px;">üìç</span>
        <span>Pick a ski resort on the map</span>
      </div>
      <div class="mapShell"><div id="map" aria-label="Map"></div>
      <!-- MAP SEARCH (toggle) -->
      <div class="mapSearch collapsed" id="mapSearch" aria-label="Search mountains">
        <button class="mapSearchBtn" id="mapSearchBtn" type="button" title="Search">üîé</button>
        <div class="mapSearchPanel" id="mapSearchPanel">
          <input id="mapSearchInput" type="text" placeholder="Search mountain, region, country‚Ä¶" autocomplete="off">
          <div class="mapSearchResults" id="mapSearchResults"></div>
        </div>
      </div>
</div>
<div class="ctaRow">
        <div id="selectedMountainLabel" style="color:var(--gj-ink2); font-weight:700;">No mountain selected yet.</div>
        </div>
    </div>
  </section>

  <section class="stepCard" id="step-weather">
    <div class="stepTop">
      <div class="stepPill">Step 2</div>
      <div class="stepTitle">Weather</div>
    </div>
    <div class="stepSub">We‚Äôll use the forecast to pick the right layers.</div>

    <div class="grid2">
      <div class="miniCard">
        <div class="weatherTop">
          <div class="weatherNow">
            <div class="weatherNowTemp" id="weatherNowTemp">‚Äî</div>
            <div class="weatherNowMeta" id="weatherHeadline">Pick a mountain ‚Äî forecast will appear automatically.</div>
          </div>
          <div class="datePickWrap">
            <div class="datePickLabel">Date</div>
            <input type="date" id="datePicker" />
          </div>
        </div>

        <div class="weekGrid" id="weekGrid"></div>

        <details class="dayDetails" id="dayDetails">
          <summary>
            <span style="font-weight:900;">Details</span>
            <span id="dayDetailsSummary" style="opacity:.8; font-weight:700;">Select a day to view charts.</span>
            <span class="weekChevron" aria-hidden="true">‚ñæ</span>
          </summary>
          <div class="dayDetailsInner">
            <div class="tabs" id="chartTabs">
              <button type="button" class="tabBtn active" data-metric="temp">Temperature</button>
              <button type="button" class="tabBtn" data-metric="precip">Precipitation</button>
              <button type="button" class="tabBtn" data-metric="wind">Wind</button>
            </div>

            <div class="chartWrap">
              <canvas id="weatherChart" height="160"></canvas>
            </div>

            <div class="dayStats" id="dayStats">‚Äî</div>
          </div>
        </details>
      </div>
</div>
  </section>
<section class="stepCard" id="step-gear">
    <div class="stepTop">
      <div class="stepPill">Step 3</div>
      <div class="stepTitle">Your gear</div>
    </div>
    <div class="stepSub">We‚Äôll summarize your setup and open the Gear Finder.</div>

    <div class="frostInner">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
        <div>
          <div style="font-weight:900; font-size:18px;">You‚Äôre <span id="readyPct" style="color:#1f7a45;">‚Äî</span> READY</div>
          <div id="readySub" style="color:var(--gj-ink2);">Select destination + day to calculate.</div>
        </div>
        <div style="min-width:240px; flex:1; max-width:420px;">
          <div class="progressWrap" aria-label="Readiness"><div class="progressFill" id="readyBar"></div></div>
        </div>
      </div>

      <div class="ctaRow" style="margin-top:14px;">
        <div id="summaryLine" style="color:var(--gj-ink2); font-weight:700;">We‚Äôll carry your destination and temperature into Gear Finder.</div>
        <a class="btnPrimary" id="btnGoGear" href="gear.html">Open Gear Finder ‚Üí</a>
      </div>
    </div>
  </section>

</main>
<footer class="siteFooter" role="contentinfo">
    <div class="footerInner">
      <div>
        <div class="footerBrand">
          <span style="filter: drop-shadow(0 0 10px rgba(42,109,255,0.35));">üèîÔ∏è</span>
          <span>RIDEKIT.FR</span>
        </div>
        <div class="footerDesc">
          A simple helper for choosing ski / snowboard gear based on weather and conditions.
          Always double‚Äëcheck real forecasts and avalanche bulletins before going to the mountains.
        </div>
      </div>

      <div class="footerCol">
        <h4>Navigation</h4>
        <div class="footerLinks">
          <a href="index.html">Resort map</a>
          <a href="gear.html">Gear finder</a>
        </div>
      </div>

      <div class="footerCol">
        <h4>Data & Sources</h4>
        <div class="footerLinks">
          <a href="https://open-meteo.com/" target="_blank" rel="noopener">Forecast: Open‚ÄëMeteo API</a>
          <a href="https://www.openstreetmap.org/" target="_blank" rel="noopener">Map: OpenStreetMap</a>
          <a href="privacy.html">Privacy policy</a>
        </div>
      </div>
    </div>

    <div class="footerBottom">
      <div>Made with ‚ù§Ô∏è for snowy adventures</div>
      <div>¬© 2026 RIDEKIT. All rights reserved.</div>
    </div>
  </footer>


<script>
// ===== SNOWFALL EFFECT (visual only) =====
function createSnowfall() {
  const container = document.getElementById('snowfall');
  if (!container) return;
  container.innerHTML = "";
  const count = 60;

  for (let i = 0; i < count; i++) {
    const flake = document.createElement('div');
    flake.className = 'snowflake';
    flake.style.left = Math.random() * 100 + '%';
    const size = (2 + Math.random() * 4);
    flake.style.width = size + 'px';
    flake.style.height = size + 'px';
    flake.style.animationDuration = (8 + Math.random() * 12) + 's';
    flake.style.animationDelay = (Math.random() * 10) + 's';
    flake.style.opacity = (0.25 + Math.random() * 0.65).toFixed(2);
    container.appendChild(flake);
  }
}
createSnowfall();

const PLACEHOLDER_MOUNTAIN_IMAGE = "./assets/mountains/zaplatka.jpg";

// ========= LOAD LOCATIONS =========
  async function loadLocations() {
    // Load mountains from GeoJSON (supports both /data and repo root)
    const candidates = ["./data/locations.geojson", "./locations.geojson", "locations.geojson"];
    let res = null;
    for (const p of candidates) {
      try {
        const r = await fetch(p, { cache: "no-store" });
        if (r && r.ok) { res = r; break; }
      } catch (e) {
        // try next
      }
    }
    if (!res) throw new Error("Failed to load GeoJSON. Tried: " + candidates.join(", "));
    const geo = await res.json();

    return (geo.features || []).map(f => {
      const p = f.properties || {};
      const coords = (f.geometry && f.geometry.coordinates) ? f.geometry.coordinates : [0,0];
      const lon = Number(coords[0]);
      const lat = Number(coords[1]);

      return {
        id: p.id ?? `${p.name ?? "loc"}-${lat.toFixed(4)}-${lon.toFixed(4)}`,
        name: p.name ?? "Unknown mountain",
        region: p.region ?? "",
        country: p.country ?? "",
        image: (p.image && String(p.image).trim()) ? p.image : PLACEHOLDER_MOUNTAIN_IMAGE,
        lat, lon,
        base_m: p.base_m ?? null,
        top_m: p.top_m ?? null,
        tempProfile: { mild: p.mild, normal: p.normal, cold: p.cold }
      };
    });
  }


  // ========= MAP INIT =========
  const map = L.map("map", { zoomControl:true }).setView([45.5, 6.6], 8);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 18,
    attribution: "&copy; OpenStreetMap contributors"
  }).addTo(map);

  const markersLayer = L.markerClusterGroup({ showCoverageOnHover:false, spiderfyOnMaxZoom:true });
  map.addLayer(markersLayer);

  setTimeout(() => map.invalidateSize(), 250);

  // ========= WEATHER (Open-Meteo) =========

  function setTempBig(valueC){
    const v = (typeof valueC === "number" && isFinite(valueC)) ? Math.round(valueC) : null;
    const elA = document.getElementById("tempBig");
    const elB = document.getElementById("weatherNowTemp");
    const txt = (v === null) ? "‚Äî" : `${v}¬∞C`;
    if (elA) elA.textContent = txt;
    if (elB) elB.textContent = txt;
  }

  function setDatePickerValue(dateStr){
    const dp = document.getElementById("datePicker");
    if (!dp) return;
    dp.value = dateStr;
  }

  function getDatePickerValue(){
    const dp = document.getElementById("datePicker");
    return dp?.value || new Date().toISOString().slice(0,10);
  }

  function pickSelectedDayFromDaily(daily, dateStr){
    if (!daily?.time?.length) return null;
    const i = daily.time.indexOf(dateStr);
    if (i === -1) return null;
    return pickDaily(daily, i);
  }

  const weatherCache = new Map();
  const WEATHER_TTL_MS = 15 * 60 * 1000;
  function cacheKey(lat, lon){ return `${lat.toFixed(3)},${lon.toFixed(3)}`; }

  function weatherCodeToText(code) {
    const m = {
      0:"Clear",1:"Mostly clear",2:"Partly cloudy",3:"Overcast",45:"Fog",48:"Rime fog",
      51:"Light drizzle",53:"Drizzle",55:"Heavy drizzle",
      61:"Light rain",63:"Rain",65:"Heavy rain",
      71:"Light snow",73:"Snow",75:"Heavy snow",
      80:"Rain showers",85:"Snow showers",
      95:"Thunderstorm"
    };
    return m[code] ?? `Weather code ${code}`;
  }

  function weatherCodeToEmoji(code){
    if (code === 0) return "‚òÄÔ∏è";
    if (code === 1) return "üå§Ô∏è";
    if (code === 2) return "‚õÖ";
    if (code === 3) return "‚òÅÔ∏è";
    if (code === 45 || code === 48) return "üå´Ô∏è";
    if (code >= 51 && code <= 55) return "üå¶Ô∏è";
    if (code >= 61 && code <= 65) return "üåßÔ∏è";
    if (code === 80) return "üå¶Ô∏è";
    if (code === 95) return "‚õàÔ∏è";
    if (code === 71 || code === 73 || code === 75) return "‚ùÑÔ∏è";
    if (code === 85) return "üå®Ô∏è";
    return "üå°Ô∏è";
  }

  async function getWeather(lat, lon, startDateStr){
  // Open-Meteo: we fetch a 7-day window starting at selected date (within forecast horizon).
  const start = startDateStr || new Date().toISOString().slice(0,10);
  const startDt = new Date(start + "T00:00:00");
  const endDt = new Date(startDt.getTime() + 7*24*60*60*1000);
  const end = endDt.toISOString().slice(0,10);

  const url = "https://api.open-meteo.com/v1/forecast"
    + `?latitude=${encodeURIComponent(lat)}`
    + `&longitude=${encodeURIComponent(lon)}`
    + "&timezone=auto"
    + "&current_weather=true"
    + "&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum,snowfall_sum,windspeed_10m_max"
    + "&hourly=temperature_2m,precipitation,snowfall,windspeed_10m,relativehumidity_2m,weathercode"
    + `&start_date=${start}`
    + `&end_date=${end}`;

  const controller = new AbortController();
  const t = setTimeout(() => controller.abort(), 9000);
  try{
    const r = await fetch(url, { signal: controller.signal, cache: "no-store" });
    if (!r.ok) throw new Error("Open-Meteo HTTP " + r.status);
    return await r.json();
  } finally {
    clearTimeout(t);
  }
}

  function pickDaily(daily, idx){
    return {
      date: daily.time?.[idx],
      tmin: daily.temperature_2m_min?.[idx],
      tmax: daily.temperature_2m_max?.[idx],
      precip: daily.precipitation_sum?.[idx],
      snow: daily.snowfall_sum?.[idx],
      windMax: daily.windspeed_10m_max?.[idx],
      code: daily.weathercode?.[idx],
    };
  }

  function pickDailyByDate(daily, dateStr){
    const times = daily?.time || [];
    const idx = times.indexOf(dateStr);
    if (idx === -1) return null;
    return pickDaily(daily, idx);
  }

  function pickHourlyForDate(hourly, dateStr){
    const times = hourly?.time || [];
    const out = [];
    for (let i=0;i<times.length;i++){
      if (times[i].startsWith(dateStr)){
        out.push({
          time: times[i],
          temp: hourly.temperature_2m?.[i],
          precip: hourly.precipitation?.[i],
          snow: hourly.snowfall?.[i],
          wind: hourly.windspeed_10m?.[i],
          code: hourly.weathercode?.[i],
        });
      }
    }
    return out;
  }

  function svgSparkline(values, w=900, h=76, pad=10, unitText=""){
    const nums = values.filter(v => typeof v === "number" && isFinite(v));
    if (!nums.length) return `<svg viewBox="0 0 ${w} ${h}" width="100%" height="100%"></svg>`;

    const minV = Math.min(...nums);
    const maxV = Math.max(...nums);
    const range = (maxV - minV) || 1;

    const stepX = (w - pad*2) / Math.max(values.length - 1, 1);

    const pts = values.map((v, idx) => {
      const safe = (typeof v === "number" && isFinite(v)) ? v : minV;
      const x = pad + idx * stepX;
      const y = pad + (h - pad*2) * (1 - ((safe - minV) / range));
      return `${x.toFixed(1)},${y.toFixed(1)}`;
    }).join(" ");

    const minLabel = `${Math.round(minV)}${unitText}`;
    const maxLabel = `${Math.round(maxV)}${unitText}`;

    return `
      <svg viewBox="0 0 ${w} ${h}" width="100%" height="100%" preserveAspectRatio="none">
        <polyline points="${pts}" fill="none" stroke="rgba(234,240,255,0.85)" stroke-width="2" />
        <text x="${pad}" y="${pad+14}" fill="rgba(159,176,208,0.9)" font-size="12">${minLabel}</text>
        <text x="${w-pad-50}" y="${pad+14}" fill="rgba(159,176,208,0.9)" font-size="12">${maxLabel}</text>
      </svg>
    `;
  }

  function metricSeries(hours, metric){
    if (metric === "precip") return hours.map(h => h.precip);
    if (metric === "wind") return hours.map(h => h.wind);
    return hours.map(h => h.temp);
  }
  function metricUnit(metric){
    if (metric === "precip") return "mm";
    if (metric === "wind") return "km/h";
    return "¬∞C";
  }

  function renderHourlyForecast(hours){
    const slice = hours.slice(0, 24);
    if (!slice.length){
      return `
        <div class="hourlyWrap">
          <div class="muted">Hourly</div>
          <div class="hint" style="margin-top:8px;">No hourly data for this date.</div>
        </div>
      `;
    }

    const series = metricSeries(slice, state.metric);
    const unit = metricUnit(state.metric);
    const chart = svgSparkline(series, 900, 76, 10, unit === "¬∞C" ? "¬∞" : "");

    const cards = slice.map(h => {
      const hh = h.time.split("T")[1]?.slice(0,5) || "";
      const emoji = weatherCodeToEmoji(h.code);
      const txt = weatherCodeToText(h.code);

      const valTemp = (typeof h.temp === "number") ? `${Math.round(h.temp)}¬∞` : "‚Äî";
      const valPrecip = (typeof h.precip === "number") ? `${h.precip.toFixed(1)}mm` : "‚Äî";
      const valSnow = (typeof h.snow === "number") ? `${h.snow.toFixed(1)}cm` : "‚Äî";
      const valWind = (typeof h.wind === "number") ? `${Math.round(h.wind)}km/h` : "‚Äî";

      let big = valTemp;
      let meta1 = `Wind: ${valWind}`;
      let meta2 = `P: ${valPrecip} ‚Ä¢ S: ${valSnow}`;

      if (state.metric === "precip"){
        big = valPrecip;
        meta1 = `Temp: ${valTemp}`;
        meta2 = `Wind: ${valWind} ‚Ä¢ Snow: ${valSnow}`;
      } else if (state.metric === "wind"){
        big = valWind;
        meta1 = `Temp: ${valTemp}`;
        meta2 = `Precip: ${valPrecip} ‚Ä¢ Snow: ${valSnow}`;
      }

      return `
        <div class="hourCard">
          <div class="hourTop">
            <div class="hourTime">${hh}</div>
            <div class="hourEmoji" title="${txt}">${emoji}</div>
          </div>
          <div class="hourBig">${big}</div>
          <div class="hourMeta">${txt}</div>
          <div class="hourMeta">${meta1}</div>
          <div class="hourMeta">${meta2}</div>
        </div>
      `;
    }).join("");

    return `
      <div class="hourlyWrap">
        <div class="muted">Hourly (24h)</div>

        <div class="hourlyChart">${chart}</div>

        <div class="seg hourlySeg" style="margin-top:10px;">
          <button type="button" data-m="temp" class="${state.metric==="temp"?"active":""}">üå°Ô∏è Temp</button>
          <button type="button" data-m="precip" class="${state.metric==="precip"?"active":""}">üåßÔ∏è Precip</button>
          <button type="button" data-m="wind" class="${state.metric==="wind"?"active":""}">üí® Wind</button>
        </div>

        <div class="hourlyRow">${cards}</div>
      </div>
    `;
  }

  // ========= STATE =========
  const state = {
    tempC: -8,
    date: null,
    metric: "temp",
    outfitMode: "base", // "base" | "shell"

    // Checkbox pins state (what user has checked)
    checks: { base: {}, shell: {} }
  };

  let selectedLocationId = null;
  let LAST_WEATHER_DATA = null;
  let CURRENT_LOC = null;
  // ========= SHARE SELECTION WITH gear.html (localStorage) =========
  const RK_SEL_KEY = "rk_selection_v1";

  function saveSelection(extra = {}) {
    try {
      const base = CURRENT_LOC ? {
        id: CURRENT_LOC.id,
        name: CURRENT_LOC.name,
        region: CURRENT_LOC.region,
        country: CURRENT_LOC.country,
        lat: CURRENT_LOC.lat,
        lon: CURRENT_LOC.lon,
        base_m: CURRENT_LOC.base_m,
        top_m: CURRENT_LOC.top_m,
        image: CURRENT_LOC.image
      } : {};

      const payload = {
        ...base,
        date: state.date || null,
        tempC: state.tempC,
        // optional day range (if available)
        tmin: extra.tmin ?? extra.tmin,
        tmax: extra.tmax ?? extra.tmax,
        ts: Date.now()
      };

      // normalize NaNs
      ["tempC","tmin","tmax"].forEach(k => {
        const v = payload[k];
        if (typeof v === "number" && !isFinite(v)) payload[k] = null;
      });

      localStorage.setItem(RK_SEL_KEY, JSON.stringify(payload));
    } catch (e) {}
  }

  function clearSelection() {
    try { localStorage.removeItem(RK_SEL_KEY); } catch (e) {}
  }


  function tempLevel(t){
    if (t <= -12) return "Very cold";
    if (t <= -6) return "Cold";
    if (t <= 0) return "Near freezing";
    return "Mild";
  }

  // ========= AVATAR ENGINE (PNG layers) =========
  const AVATAR_BASE_W = 715;
  const AVATAR_BASE_H = 1138;
  const ASSET = (name) => `./assets/outfit/${name}`;

  function updateAvatarScale(){
    const stage = document.getElementById("avatarStage");
    const canvas = document.getElementById("avatarCanvas");
    const checks = document.getElementById("checkCanvas");
    if (!stage || !canvas) return;
    const scale = stage.clientWidth / AVATAR_BASE_W;
    canvas.style.transform = `scale(${scale})`;
    if (checks) checks.style.transform = `scale(${scale})`;
  }
  window.addEventListener("resize", updateAvatarScale);

  function applyLayer(id, cfg){
    const el = document.getElementById(id);
    if (!el) return;

    if (!cfg || !cfg.src){
      el.style.display = "none";
      el.removeAttribute("src");
      return;
    }
    el.src = cfg.src;
    el.style.display = "";

    el.style.left = `${cfg.x ?? 0}px`;
    el.style.top  = `${cfg.y ?? 0}px`;

    const r = cfg.r ?? 0;
    el.style.transform = `rotate(${r}deg)`;
    el.style.transformOrigin = cfg.origin || "50% 20%";
    el.style.zIndex = `${cfg.z ?? 10}`;
  }

  
  // ===== LAYOUT OVERRIDES STORAGE (DEV TOOL) =====
  (function initLayoutOverrides(){
    const KEY = "mml_layout_overrides_v1";
    try{
      const raw = localStorage.getItem(KEY);
      window.LAYOUT_OVERRIDES = raw ? JSON.parse(raw) : {};
    }catch(e){
      window.LAYOUT_OVERRIDES = {};
    }
    window.__SAVE_LAYOUT_OVERRIDES = function(){
      try{ localStorage.setItem(KEY, JSON.stringify(window.LAYOUT_OVERRIDES || {})); }catch(e){}
    };
  })();

// ===== Positions (from your Figma notes) =====
  const POS = {
    head_light:   { src: ASSET("light_head.png"),    x:237,   y:48,     r:0,    z:55, origin:"50% 50%" },
    // head light position was changed because it doesn't correspond to Figma for some reason, so now the standart is x 233, y 48
    base_top:     { src: ASSET("light_base.png"),    x:100,   y:125,    r:0,    z:60, origin:"50% 50%" },

    pants_base:   { src: ASSET("base_pants.png"),    x:132,   y:532,    r:0,    z:20, origin:"50% 50%" },
    pants_medium: { src: ASSET("medium_pants.png"),  x:115,   y:508,    r:0,    z:20, origin:"50% 50%" },

    // Shell pants (windproof)
    pants_shell:  { src: ASSET("heavy_pants.png"), x: -15,  y:410, r:-1.0, z:20, origin:"50% 50%" },
    pants_shell_2: { src: ASSET("heavy_pants_2.png"), x:110, y:515, r:2.45, z:20, origin:"50% 50%" },

    socks_light:  { src: ASSET("light_socks.png"),   x:100,   y:959,    r:0,    z:10, origin:"50% 50%" },
    socks_heavy:  { src: ASSET("heavy_socks.png"),   x:59,    y:983,    r:0,    z:10, origin:"50% 50%" },

    gloves_light: { src: ASSET("light_gloves.png"),  x:155,   y:520,    r:0,    z:50, origin:"50% 50%" },
    gloves_heavy: { src: ASSET("heavy_gloves.png"),  x:138,   y:533,    r:2.94, z:50, origin:"50% 50%" },

    // Shell jacket (always in Shell tab)
    jacket_light:  { src: ASSET("light_jacket.png"),  x:75.16, y:149.61, r:1.3,  z:80, origin:"50% 50%" },
    jacket_medium: { src: ASSET("medium_jacket.png"), x:85.18, y:173.15, r:1.21, z:80, origin:"50% 50%" },
    jacket_heavy:  { src: ASSET("heavy_jacket.png"),  x:85.81, y:150.07, r:0.47, z:80, origin:"50% 50%" },

    // Hood = sweater (Base tab only)
    hood_01: { src: ASSET("heavy_hood_01.png"), x:88,    y:118,    r: 2.23, z:70, origin:"50% 50%" },
    hood_02: { src: ASSET("heavy_hood_2.png"),  x:46,    y:195,    r: 3.0, z:70, origin:"50% 50%" },
    hood_03: { src: ASSET("heavy_hood_3.png"),  x:74.26, y:188.09, r: 1.19, z:70, origin:"50% 50%" },
  };
    // ========= LAYOUT EDITOR (DEV TOOL) =========
    const __POS_ORIGINAL__ = JSON.parse(JSON.stringify(POS));

    function __posKeys__() { return Object.keys(POS || {}); }

    function __openLayoutEditor__(open) {
      const p = document.getElementById("layoutEditPanel");
      if (!p) return;
      p.classList.toggle("open", !!open);
      p.setAttribute("aria-hidden", open ? "false" : "true");
    }

    function __syncEditorFields__(key) {
      const cfg = POS[key];
      if (!cfg) return;
      const x = document.getElementById("layoutEditX");
      const y = document.getElementById("layoutEditY");
      const r = document.getElementById("layoutEditR");
      const z = document.getElementById("layoutEditZ");
      if (x) x.value = cfg.x ?? 0;
      if (y) y.value = cfg.y ?? 0;
      if (r) r.value = cfg.r ?? 0;
      if (z) z.value = cfg.z ?? 10;
    }

    function __applyFromFields__(key) {
      const cfg = POS[key];
      if (!cfg) return;

      const x = parseFloat(document.getElementById("layoutEditX")?.value ?? cfg.x ?? 0);
      const y = parseFloat(document.getElementById("layoutEditY")?.value ?? cfg.y ?? 0);
      const r = parseFloat(document.getElementById("layoutEditR")?.value ?? cfg.r ?? 0);
      const z = parseInt(document.getElementById("layoutEditZ")?.value ?? cfg.z ?? 10, 10);

      cfg.x = isFinite(x) ? x : (cfg.x ?? 0);
      cfg.y = isFinite(y) ? y : (cfg.y ?? 0);
      cfg.r = isFinite(r) ? r : (cfg.r ?? 0);
      cfg.z = isFinite(z) ? z : (cfg.z ?? 10);

      // Re-apply current outfit to see changes immediately
      try { applyOutfit(); updateAvatarScale(); } catch(e) {}
    }

    function __copyPOSJson__() {
      const pretty = JSON.stringify(POS, null, 2);
      navigator.clipboard?.writeText(pretty).then(() => {
        const btn = document.getElementById("layoutEditCopy");
        if (btn) {
          const old = btn.textContent;
          btn.textContent = "Copied!";
          setTimeout(() => btn.textContent = old, 900);
        }
      }).catch(() => {
        alert("Couldn't copy. Your browser blocked clipboard access.");
      });
    }

    function __resetPOS__() {
      // restore original
      __posKeys__().forEach(k => delete POS[k]);
      Object.keys(__POS_ORIGINAL__).forEach(k => POS[k] = JSON.parse(JSON.stringify(__POS_ORIGINAL__[k])));
      const sel = document.getElementById("layoutEditSelect");
      const key = sel?.value || __posKeys__()[0];
      if (key) __syncEditorFields__(key);
      try { applyOutfit(); updateAvatarScale(); } catch(e) {}
    }

    function wireLayoutEditor() {
      const btn = document.getElementById("layoutEditBtn");
      const close = document.getElementById("layoutEditClose");
      const panel = document.getElementById("layoutEditPanel");
      const sel = document.getElementById("layoutEditSelect");

      if (!btn || !panel || !sel) return;

      // populate select
      sel.innerHTML = __posKeys__().map(k => `<option value="${k}">${k}</option>`).join("");

      const initialKey = sel.value || __posKeys__()[0];
      if (initialKey) __syncEditorFields__(initialKey);

      btn.addEventListener("click", () => __openLayoutEditor__(!panel.classList.contains("open")));
      close?.addEventListener("click", () => __openLayoutEditor__(false));

      sel.addEventListener("change", () => __syncEditorFields__(sel.value));

      ["layoutEditX", "layoutEditY", "layoutEditR", "layoutEditZ"].forEach(id => {
        document.getElementById(id)?.addEventListener("input", () => __applyFromFields__(sel.value));
      });

      document.getElementById("layoutEditCopy")?.addEventListener("click", __copyPOSJson__);
      document.getElementById("layoutEditReset")?.addEventListener("click", __resetPOS__);

      // close on ESC
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") __openLayoutEditor__(false);
      });
    }


  // glove overrides when hood variant is used (your notes)
  const GLOVES_OVERRIDE_BY_HOOD = {
    "heavy_hood_01.png": {
      light: { x:155, y:540, r:0 },
      heavy: { x:142, y:506, r:2.94 }
    },
    "heavy_hood_2.png": {
      light: { x:155, y:540, r:0 },
      heavy: { x:139, y:513, r:2.94 }
    },
    "heavy_hood_3.png": {
      light: { x:164, y:539, r:0 },
      heavy: { x:132, y:516, r:2.94 }
    },
  };

    // 
  
  function setGloves(type, hoodFileNameOrNull){
    const base = (type === "heavy") ? POS.gloves_heavy : POS.gloves_light;

    if (hoodFileNameOrNull){
      const o = GLOVES_OVERRIDE_BY_HOOD[hoodFileNameOrNull];
      if (o){
        const adj = (type === "heavy") ? o.heavy : o.light;
        if (adj){
          const cfg = { ...base, x: adj.x, y: adj.y, r: adj.r ?? base.r };
          applyLayer("layerGloves", cfg);
          return cfg;
        }
      }
    }
    applyLayer("layerGloves", base);
    return base;
  }

  // Choose which hood picture to use when hood is enabled
  // ================= Sweater (hood) selection =================
// NOTE: "hood" = sweater / mid-layer top in your project naming.
//
// ‚úÖ THIS IS THE PLACE TO CHANGE HOW SWEATER VARIANTS DEPEND ON TEMPERATURE.
// If you want to force a specific sweater for testing, set HOOD_FORCE_VARIANT
// to: "heavy_hood_01.png" | "heavy_hood_2.png" | "heavy_hood_3.png"
// and refresh.
let HOOD_FORCE_VARIANT = null;

function chooseHoodVariant(tempC){
  // ===== CHANGE HOOD TEMPERATURE THRESHOLDS HERE =====
  // Sweater (hood_01/02/03) changes with temperature.
  // You can tweak these numbers anytime later.
  if (HOOD_FORCE_VARIANT) return HOOD_FORCE_VARIANT;

  if (tempC <= -12) return "heavy_hood_3.png";   // very cold -> warmest sweater
  if (tempC <= -8)  return "heavy_hood_2.png";   // cold
  return "heavy_hood_01.png";                    // slightly cold (-8..-6)
}


// ================= Shell pants (auto) =================
// NOTE: Shell pants are ONLY used in Shell tab.
// We auto-pick between heavy_pants.png and heavy_pants_2.png depending on temperature.
//
// ‚úÖ CHANGE THRESHOLD HERE if you want:
//   temp <= -10  -> heavy_pants_2 (warmer / different cut)
//   else         -> heavy_pants   (lighter shell pants)
function chooseShellPantsCfg(tempC){
  if (tempC <= -10) return POS.pants_shell_2; // heavy_pants_2.png
  return POS.pants_shell;                    // heavy_pants.png
}
// heavy_hood_01.png | heavy_hood_2.png | heavy_hood_3.png

  // ================= Checkbox pins (Base / Shell) =================
  // Pins are positioned in the same 715x1138 coordinate system as the avatar.
  // You can move them by changing x/y below.
  const CHECK_UI = {
    base: [
      { key:"head",   label:"Balaclava",  x:210, y:120, side:"left",  targets:["layerHead"] },
      { key:"top",    label:"Top",        x:560, y:270, side:"right", targets:["layerBaseTop","layerHood"] },
      { key:"gloves", label:"Gloves",     x:180, y:560, side:"left",  targets:["layerGloves"] },
      { key:"pants",  label:"Pants",      x:565, y:720, side:"right", targets:["layerPants"] },
      { key:"socks",  label:"Socks",      x:190, y:1000,side:"left",  targets:["layerSocks"] },
    ],
    shell: [
      { key:"head",   label:"Balaclava",  x:210, y:120, side:"left",  targets:["layerHead"] },
      { key:"jacket", label:"Shell",      x:560, y:240, side:"right", targets:["layerShell"] },
      { key:"gloves", label:"Gloves",     x:180, y:560, side:"left",  targets:["layerGloves"] },
      { key:"pants",  label:"Pants",      x:565, y:760, side:"right", targets:["layerPants"] },
      { key:"socks",  label:"Socks",      x:190, y:1000,side:"left",  targets:["layerSocks"] },
    ]
  };

  function applyCheckTints(){
    // remove tint from all layers first
    ["layerSocks","layerPants","layerHead","layerGloves","layerBaseTop","layerHood","layerShell"]
      .forEach(id => document.getElementById(id)?.classList.remove("tinted"));

    const mode = state.outfitMode;
    const store = state.checks?.[mode] || {};
    const items = CHECK_UI[mode] || [];

    items.forEach(it => {
      if (!store[it.key]) return;
      (it.targets || []).forEach(tid => {
        const el = document.getElementById(tid);
        if (!el) return;
        // tint only if the layer is actually visible
        if (el.style.display !== "none") el.classList.add("tinted");
      });
    });
  }

  function renderCheckPins(){
    const box = document.getElementById("checkCanvas");
    if (!box) return;

    const mode = state.outfitMode;
    const items = CHECK_UI[mode] || [];
    const store = state.checks[mode];

    box.innerHTML = items.map(it => {
      const checked = store[it.key] ? "checked" : "";
      const sideCls = (it.side === "left") ? "side-left" : "side-right";
      return `
        <label class="checkPin ${sideCls}" style="left:${it.x}px; top:${it.y}px" data-key="${it.key}">
          <div class="checkTitle">${it.label}</div>
          <input type="checkbox" ${checked}>
        </label>
      `;
    }).join("");

    // wire events
    box.querySelectorAll("input[type=checkbox]").forEach(inp => {
      inp.addEventListener("change", (e) => {
        const wrap = e.target.closest(".checkPin");
        const key = wrap?.dataset?.key;
        if (!key) return;
        store[key] = e.target.checked;
        applyCheckTints();
        updateOutfitPanels();
      });
    });

    applyCheckTints();
  }

  /*
    ========= TEMPERATURE -> SELECTION (IMPORTANT, –ø–æ–¥–ø–∏—Å–∞–Ω–æ –∫–∞–∫ —Ç—ã –ø—Ä–æ—Å–∏–ª) =========

    1) Gloves:
       - temp <= -12  -> heavy_gloves
       - else         -> light_gloves

    2) Socks:
       - temp <= -6   -> heavy_socks
       - else         -> light_socks

    3) Base mode (Base tab):
       - Base top: always ON
       - Hood (sweater): ON when temp <= -6, OFF when temp > -6
       - Pants:
           temp <= -6 -> medium_pants
           else       -> base_pants
       - Jacket: OFF (never)

    4) Shell mode (Shell tab):
       - Jacket:
           temp <= -12 -> heavy_jacket
           temp <= -6  -> medium_jacket
           else        -> light_jacket
       - Shell pants (windproof): always ON (heavy_pants_2)
       - Hood: OFF (never)
       - Base top: OFF (optional, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–æ ‚Äî –≤–∫–ª—é—á–∏–º –ø–æ–∑–∂–µ –µ—Å–ª–∏ –Ω–∞–¥–æ)
  */
  // ===== Outfit text panel (right side) =====
function renderSet(containerId, items){
  const el = document.getElementById(containerId);
  if (!el) return;
  if (!items || !items.length){
    el.textContent = "‚Äî";
    return;
  }

  // ‚úÖ highlight list items when the corresponding checkbox pin is checked
  const store = (containerId === "setShell") ? state.checks.shell : state.checks.base;

  el.innerHTML = items.map(it => {
    const checkedCls = (it.key && store[it.key]) ? "checked" : "";
    const keyAttr = it.key ? `data-key="${it.key}"` : "";
    return `
      <div class="setItem ${checkedCls}" ${keyAttr}>
        <div class="setItemTop">
          <b>${it.title}</b>
          <span class="setFile">${it.file}</span>
        </div>
        <div class="setDesc">${it.desc}</div>
      </div>
    `;
  }).join("");
}

function buildBaseSet(tempC){
  const socksFile = (tempC <= -6) ? "heavy_socks.png" : "light_socks.png";
  const glovesFile = (tempC <= -12) ? "heavy_gloves.png" : "light_gloves.png";
  const pantsFile = (tempC <= -6) ? "medium_pants.png" : "base_pants.png";

  const items = [
    { key:"head", title: "Balaclava", file: "light_head.png",
      desc: "Face + neck protection from wind. Breathable so it doesn‚Äôt get wet inside." },

    { key:"socks", title: "Socks", file: socksFile,
      desc: (tempC <= -6) ? "Warm merino / thermal socks for cold mornings." : "Lighter socks for milder days." },

    { key:"pants", title: "Pants (base/mid)", file: pantsFile,
      desc: (tempC <= -6) ? "Mid-layer pants for insulation (still breathable for touring)." : "Light base pants for mobility and sweat management." },

    { key:"gloves", title: "Gloves", file: glovesFile,
      desc: (tempC <= -12) ? "Warm gloves for very cold conditions." : "Lighter gloves for active touring." },
  ];

  // In Base tab you said: either Base top OR Sweater (never together)
  if (tempC <= -6){
    const hoodFile = chooseHoodVariant(tempC);
    items.splice(2, 0, {
      key:"top", title: "Sweater (mid layer)",
      file: hoodFile,
      desc: "Insulating sweater between base and shell. Auto-selected by temperature (see code comment near chooseHoodVariant)."
    });
  } else {
    items.splice(2, 0, {
      key:"top", title: "Base top",
      file: "light_base.png",
      desc: "Next-to-skin layer that wicks sweat and dries fast."
    });
  }

  return items;
}

function buildShellSet(tempC){
  const socksFile = (tempC <= -6) ? "heavy_socks.png" : "light_socks.png";
  const glovesFile = (tempC <= -12) ? "heavy_gloves.png" : "light_gloves.png";

  const jacketFile =
    (tempC <= -12) ? "heavy_jacket.png" :
    (tempC <= -6)  ? "medium_jacket.png" :
                     "light_jacket.png";

  const pantsFile = (tempC <= -10) ? "heavy_pants_2.png" : "heavy_pants.png";
  return [
    { key:"head", title: "Balaclava", file: "light_head.png",
      desc: "Still useful under shell hood/helmet in wind and snowfall." },

    { key:"socks", title: "Socks", file: socksFile,
      desc: (tempC <= -6) ? "Warm socks for cold + long exposure." : "Lighter socks for comfort when it‚Äôs warmer." },

    { key:"jacket", title: "Shell jacket", file: jacketFile,
      desc: "Windproof layer for descents and storms (selection depends on temperature)." },

    { key:"pants", title: "Shell pants (windproof)", file: pantsFile,
      desc: "Windproof pants for strong wind / snow. Keeps you dry and blocks drafts." },

    { key:"gloves", title: "Gloves", file: glovesFile,
      desc: "Shown under the jacket sleeves (z-index). Use warm gloves if very cold." },
  ];
}

function updateOutfitPanels(){
  const locName = CURRENT_LOC ? CURRENT_LOC.name : "‚Äî";
  const dayText = state.date || "‚Äî";

  const elLoc  = document.getElementById("outfitLoc");
  const elDay  = document.getElementById("outfitDay");
  const elTemp = document.getElementById("outfitTemp");
  const elMode = document.getElementById("outfitModeText");

  if (elLoc)  elLoc.textContent = locName;
  if (elDay)  elDay.textContent = dayText;
  if (elTemp) elTemp.textContent = `${state.tempC}¬∞C`;
  if (elMode) elMode.textContent = (state.outfitMode === "base") ? "Base" : "Shell";

  renderSet("setBase", buildBaseSet(state.tempC));
  renderSet("setShell", buildShellSet(state.tempC));
}

function applyOutfit(){
  // Reset everything first (avoid mixing)
  applyLayer("layerHood", null);
  applyLayer("layerShell", null);
  applyLayer("layerBaseTop", null);
  applyLayer("layerPants", null);

  // Always visible (and UNDER sweater/jacket/base top)
const headCfg = { ...POS.head_light };

// –µ—Å–ª–∏ Base —Ä–µ–∂–∏–º –ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è base_top (light base)
// —Ç–æ –ø–æ–¥–Ω–∏–º–∞–µ–º –±–∞–ª–∞–∫–ª–∞–≤—É –≤—ã—à–µ
if (state.outfitMode === "base" && state.tempC > -6) {
  headCfg.z = 75; // –≤—ã—à–µ base_top (60), –Ω–∏–∂–µ hood/jacket
}

 applyLayer("layerHead", headCfg);


  // Socks depend on temperature (shown in both sets)
  applyLayer("layerSocks", (state.tempC <= -6) ? POS.socks_heavy : POS.socks_light);

  // Gloves depend on temperature, but stay UNDER tops (see z-index in POS)
  const glovesType = (state.tempC <= -12) ? "heavy" : "light";

  if (state.outfitMode === "base"){
    // BASE TAB:
    // - Pants: base or medium
    applyLayer("layerPants", (state.tempC <= -6) ? POS.pants_medium : POS.pants_base);

    // - Either sweater OR base top (never both)
    let hoodFile = null;
    if (state.tempC <= -6){
      hoodFile = chooseHoodVariant(state.tempC);
      if (hoodFile === "heavy_hood_2.png") applyLayer("layerHood", POS.hood_02);
      else if (hoodFile === "heavy_hood_3.png") applyLayer("layerHood", POS.hood_03);
      else applyLayer("layerHood", POS.hood_01);
    } else {
      applyLayer("layerBaseTop", POS.base_top);
    }

    // Gloves with possible override if sweater variant changes hand cutouts
    setGloves(glovesType, hoodFile);

  } else {
    // SHELL TAB:
    // - Jacket always on (windproof)
    const jacketCfg =
      (state.tempC <= -12) ? POS.jacket_heavy :
      (state.tempC <= -6)  ? POS.jacket_medium :
                             POS.jacket_light;
    applyLayer("layerShell", jacketCfg);
    // - Shell pants: auto-pick (heavy_pants / heavy_pants_2)
    applyLayer("layerPants", chooseShellPantsCfg(state.tempC));
// Gloves (no sweater override)
    setGloves(glovesType, null);
  }

  updateOutfitPanels();
  updateAvatarScale();
  renderCheckPins();
}
// ========= HEADER NAV ACTIVE STATE =========
(function(){
  const path = (location.pathname || "").toLowerCase();
  const isGear = path.endsWith("/gear.html") || path.endsWith("gear.html");
  const homeLink = document.querySelector('.headerNav a[data-page="home"]');
  const gearLink = document.querySelector('.headerNav a[data-page="gear"]');
  if (!homeLink || !gearLink) return;
  (isGear ? gearLink : homeLink).classList.add("active");
})();

    // ========= LANGUAGE SWITCH (placeholder) =========
    (function () {
      const STORAGE_KEY = "mml_lang";

      const btns = Array.from(document.querySelectorAll(".langBtn[data-lang]"));
      if (!btns.length) return;

      function normalize(lang) {
        lang = (lang || "").toString().toLowerCase();
        if (lang.startsWith("en")) return "en";
        if (lang.startsWith("fr")) return "fr";
        if (lang.startsWith("ru")) return "ru";
        if (lang.startsWith("de")) return "de";
        return "en";
      }

      function showToast(msg) {
        let t = document.getElementById("langToast");
        if (!t) {
          t = document.createElement("div");
          t.id = "langToast";
          t.className = "toast";
          document.body.appendChild(t);
        }
        t.textContent = msg;
        t.classList.add("show");
        clearTimeout(t._hideTimer);
        t._hideTimer = setTimeout(() => t.classList.remove("show"), 2200);
      }

      function setLang(code, persist) {
        const c = normalize(code);
        document.documentElement.setAttribute("lang", c);
        document.documentElement.dataset.lang = c;
        btns.forEach(b => b.classList.toggle("active", b.dataset.lang === c));
        if (persist) localStorage.setItem(STORAGE_KEY, c);
        showToast(`Language: ${c.toUpperCase()} (translations coming soon)`);
      }

      const saved = localStorage.getItem(STORAGE_KEY);
      const auto = normalize(navigator.language || navigator.userLanguage || "");
      setLang(saved || auto, false);

      btns.forEach(b => b.addEventListener("click", () => setLang(b.dataset.lang, true)));
    })();


  

// ===== OUTFIT LAYOUT EDITOR (DEV TOOL) =====
(function wireLayoutEditor(){
  const editor = document.getElementById("layoutEditor");
  if (!editor) return;

  const elSelect = document.getElementById("leLayer");
  const elX = document.getElementById("leX");
  const elY = document.getElementById("leY");
  const elR = document.getElementById("leR");
  const elZ = document.getElementById("leZ");
  const btnToggle = document.getElementById("leToggle");
  const btnApply = document.getElementById("leApply");
  const btnResetOne = document.getElementById("leResetOne");
  const btnResetAll = document.getElementById("leResetAll");
  const btnCopy = document.getElementById("leCopy");

  const layerIds = [
    "layerSocks","layerPants","layerHead","layerGloves","layerBaseTop","layerHood","layerShell"
  ];

  let editOn = false;
  let dragging = null; // { id, startX, startY, origLeft, origTop, scale }

  const stage = document.getElementById("avatarStage");

  function getScale(){
    if (!stage) return 1;
    return stage.clientWidth / AVATAR_BASE_W;
  }

  function pxToNum(v){
    const n = parseFloat(String(v||"").replace("px",""));
    return isFinite(n) ? n : 0;
  }

  function getCurrentLayerStyle(id){
    const el = document.getElementById(id);
    if (!el) return { x:0, y:0, r:0, z:10, origin:"50% 20%" };

    const x = pxToNum(el.style.left);
    const y = pxToNum(el.style.top);
    const z = parseInt(el.style.zIndex || "10", 10) || 10;

    let r = 0;
    const tr = el.style.transform || "";
    const m = tr.match(/rotate\(([-0-9.]+)deg\)/);
    if (m) r = parseFloat(m[1]) || 0;

    const origin = el.style.transformOrigin || "50% 20%";
    return { x, y, r, z, origin };
  }

  function selectedId(){
    return elSelect.value || layerIds[0];
  }

  function setInputsFromLayer(id){
    const base = getCurrentLayerStyle(id);
    const ov = (window.LAYOUT_OVERRIDES && window.LAYOUT_OVERRIDES[id]) ? window.LAYOUT_OVERRIDES[id] : {};
    const v = { ...base, ...ov };

    elX.value = Math.round(v.x ?? 0);
    elY.value = Math.round(v.y ?? 0);
    elR.value = (v.r ?? 0);
    elZ.value = (v.z ?? base.z ?? 10);
  }

  function refreshLayerList(){
    const cur = selectedId();
    elSelect.innerHTML = layerIds.map(id => {
      const el = document.getElementById(id);
      const shown = el && el.style.display !== "none";
      const label = id.replace("layer","").replace(/([A-Z])/g, " $1").trim();
      return `<option value="${id}">${label}${shown ? "" : " (hidden)"}</option>`;
    }).join("");
    if (layerIds.includes(cur)) elSelect.value = cur;
    setInputsFromLayer(selectedId());
  }

  function applyFromInputs(){
    const id = selectedId();
    const x = parseFloat(elX.value);
    const y = parseFloat(elY.value);
    const r = parseFloat(elR.value);
    const z = parseInt(elZ.value, 10);

    if (!window.LAYOUT_OVERRIDES) window.LAYOUT_OVERRIDES = {};
    window.LAYOUT_OVERRIDES[id] = {
      x: isFinite(x) ? x : 0,
      y: isFinite(y) ? y : 0,
      r: isFinite(r) ? r : 0,
      z: isFinite(z) ? z : (getCurrentLayerStyle(id).z || 10)
    };
    window.__SAVE_LAYOUT_OVERRIDES?.();
    applyOutfit();
  }

  function resetOne(){
    const id = selectedId();
    if (window.LAYOUT_OVERRIDES && window.LAYOUT_OVERRIDES[id]){
      delete window.LAYOUT_OVERRIDES[id];
      window.__SAVE_LAYOUT_OVERRIDES?.();
      applyOutfit();
      setInputsFromLayer(id);
    }
  }

  function resetAll(){
    window.LAYOUT_OVERRIDES = {};
    window.__SAVE_LAYOUT_OVERRIDES?.();
    applyOutfit();
    refreshLayerList();
  }

  function setEditMode(on){
    editOn = !!on;
    document.body.classList.toggle("editMode", editOn);
    btnToggle.textContent = editOn ? "Disable edit mode" : "Enable edit mode";
  }

  // Dragging (only the selected layer)
  function onPointerDown(e){
    if (!editOn) return;
    const id = selectedId();
    const el = document.getElementById(id);
    if (!el || el.style.display === "none") return;
    if (e.target !== el) return;

    el.classList.add("dragging");
    const scale = getScale();
    const startX = e.clientX;
    const startY = e.clientY;
    const cur = getCurrentLayerStyle(id);

    dragging = { id, startX, startY, origLeft: cur.x, origTop: cur.y, scale };
    e.preventDefault();
  }

  function onPointerMove(e){
    if (!dragging) return;
    const dx = (e.clientX - dragging.startX) / dragging.scale;
    const dy = (e.clientY - dragging.startY) / dragging.scale;

    const nx = dragging.origLeft + dx;
    const ny = dragging.origTop + dy;

    if (!window.LAYOUT_OVERRIDES) window.LAYOUT_OVERRIDES = {};
    const prev = window.LAYOUT_OVERRIDES[dragging.id] || {};
    window.LAYOUT_OVERRIDES[dragging.id] = { ...prev, x: nx, y: ny };
    window.__SAVE_LAYOUT_OVERRIDES?.();

    const el = document.getElementById(dragging.id);
    if (el){
      el.style.left = `${nx}px`;
      el.style.top  = `${ny}px`;
    }

    elX.value = Math.round(nx);
    elY.value = Math.round(ny);
  }

  function onPointerUp(){
    if (!dragging) return;
    const el = document.getElementById(dragging.id);
    if (el) el.classList.remove("dragging");
    dragging = null;
  }

  async function copyJson(){
    const data = window.LAYOUT_OVERRIDES || {};
    const pretty = JSON.stringify(data, null, 2);
    try{
      await navigator.clipboard.writeText(pretty);
      alert("Layout JSON copied to clipboard.");
    }catch(e){
      prompt("Copy JSON:", pretty);
    }
  }

  elSelect.addEventListener("change", () => setInputsFromLayer(selectedId()));
  btnToggle.addEventListener("click", () => setEditMode(!editOn));
  btnApply.addEventListener("click", applyFromInputs);
  btnResetOne.addEventListener("click", resetOne);
  btnResetAll.addEventListener("click", resetAll);
  btnCopy.addEventListener("click", copyJson);

  // Keep list fresh after outfit changes
  const _applyOutfit = window.applyOutfit;
  if (typeof _applyOutfit === "function") {
    window.applyOutfit = function(){
      const r = _applyOutfit.apply(this, arguments);
      try{ refreshLayerList(); }catch(e){}
      return r;
    };
  }

  document.addEventListener("pointerdown", onPointerDown, { passive:false });
  document.addEventListener("pointermove", onPointerMove, { passive:false });
  document.addEventListener("pointerup", onPointerUp, { passive:true });
  document.addEventListener("pointercancel", onPointerUp, { passive:true });

  refreshLayerList();
  setEditMode(false);
})();


function updateSetupUI(){
  const tempVal  = document.getElementById("tempVal");
  const levelVal = document.getElementById("levelVal");
  const modeVal  = document.getElementById("modeVal");

  if (tempVal)  tempVal.textContent  = `${state.tempC}¬∞C`;
  if (levelVal) levelVal.textContent = `Level: ${tempLevel(state.tempC)}`;
  if (modeVal)  modeVal.textContent  = `Mode: ${state.outfitMode === "base" ? "Base" : "Shell"}`;

  // Re-apply outfit layers for the new temperature/mode
  applyOutfit();

  // Keep tint + list highlight in sync
  applyCheckTints();
  updateOutfitPanels();

  // keep gear.html in sync
  saveSelection();
}

  function wireSetupControls(){
  const tempRange = document.getElementById("tempRange");
  const tabBase = document.getElementById("tabBase");
  const tabShell = document.getElementById("tabShell");

  // Temperature slider (optional on this page)
  if (tempRange){
    tempRange.value = state.tempC;
    tempRange.addEventListener("input", () => {
      state.tempC = parseInt(tempRange.value, 10);
});
  }

  // Tabs are optional (this page may not have them)
  if (tabBase && tabShell){
    tabBase.addEventListener("click", () => {
      state.outfitMode = "base";
      tabBase.classList.add("active");
      tabShell.classList.remove("active");
});

    tabShell.addEventListener("click", () => {
      state.outfitMode = "shell";
      tabShell.classList.add("active");
      tabBase.classList.remove("active");
});
  }
}

  // ========= INFO HERO RENDER =========
  function setInfoImage(url){
    const bg = document.getElementById("infoBg");
    if (!bg) return;

    const tryUrl = (url && String(url).trim()) ? url : PLACEHOLDER_MOUNTAIN_IMAGE;

    // Preload image to detect missing files (404) and fall back to zaplatka
    const img = new Image();
    img.onload = () => {
      bg.style.backgroundImage = `url('${tryUrl}')`;
      bg.style.display = "";
    };
    img.onerror = () => {
      bg.style.backgroundImage = `url('${PLACEHOLDER_MOUNTAIN_IMAGE}')`;
      bg.style.display = "";
    };
    img.src = tryUrl;
  }

  function setHeroText(loc){
    document.getElementById("infoTitle").textContent = loc ? loc.name : "Pick a mountain";
    document.getElementById("infoSub").textContent = loc ? `${loc.region}, ${loc.country}` : "Click a marker on the map";

    const pillBase = document.getElementById("pillBase");
    const pillTop = document.getElementById("pillTop");

    if (loc){
      pillBase.style.display = "";
      pillTop.style.display = "";
      pillBase.textContent = `Base: ${loc.base_m}m`;
      pillTop.textContent = `Top: ${loc.top_m}m`;
    } else {
      pillBase.style.display = "none";
      pillTop.style.display = "none";
    }
  }

  // ========= FORECAST RENDER =========
  function renderPanelLoading(){
  const headlineEl = document.getElementById('weatherHeadline');
  const nowTempEl = document.getElementById('weatherNowTemp');
  const gridEl = document.getElementById('weekGrid');
  const statsEl = document.getElementById('dayStats');
  const detailsSummaryEl = document.getElementById('dayDetailsSummary');
  if (nowTempEl) nowTempEl.textContent = '‚Äî';
  if (headlineEl) headlineEl.textContent = 'Loading forecast‚Ä¶';
  if (gridEl) gridEl.innerHTML = '';
  if (detailsSummaryEl) detailsSummaryEl.textContent = 'Loading‚Ä¶';
  if (statsEl) statsEl.textContent = 'Please wait';
  destroyChart();
}

  function wireForecastEvents(){
    const dp = document.getElementById("datePick");
    if (dp){
      dp.onchange = () => {
        state.date = dp.value;
        rerenderForecast(true);
      };
    }

    document.querySelectorAll(".dayCard").forEach(c => {
      c.onclick = () => {
        state.date = c.dataset.date;
        rerenderForecast(true);
        const dp2 = document.getElementById("datePick");
        if (dp2) dp2.value = state.date;
      };
    });

    document.querySelectorAll(".hourlySeg button").forEach(b => {
      b.onclick = () => {
        state.metric = b.dataset.m;
        rerenderForecast(false);
      };
    });
  }

  function rerenderForecast(updateTempFromDaily){
    if (!LAST_WEATHER_DATA || !state.date) return;
    const dailyTimes = LAST_WEATHER_DATA.daily?.time || [];
    const day = pickDailyByDate(LAST_WEATHER_DATA.daily, state.date);
    renderForecastMini(day, dailyTimes);
// Auto-set temperature from forecast day (kept)
    if (updateTempFromDaily && day && typeof day.tmin === "number" && typeof day.tmax === "number"){
      state.tempC = Math.round((day.tmin + day.tmax) / 2);
      const range = document.getElementById("tempRange");
      if (range) range.value = state.tempC;
      saveSelection({ tmin: day.tmin, tmax: day.tmax });
}
  }

  function renderForecast(day){
    const body = document.getElementById("panelBody");
    if (!body){
      // Legacy panel removed in this build; use compact renderer
      const d = LAST_WEATHER_DATA;
      const dailyTimes = d?.daily?.time || [];
      renderForecastMini(day, dailyTimes);
      return;
    }
    const d = LAST_WEATHER_DATA;
    const dailyTimes = d?.daily?.time || [];

    const minDate = dailyTimes[0] || "";
    const maxDate = dailyTimes[dailyTimes.length - 1] || "";

    const dailyStrip = (dailyTimes.length ? `
      <div class="dailyRow">
        ${dailyTimes.map((dt, i) => {
          const dd = pickDaily(d.daily, i);
          const emo = weatherCodeToEmoji(dd.code);
          const wday = new Date(dt).toLocaleDateString(undefined, { weekday: "short" });
          const active = dt === state.date ? "active" : "";
          const tmax = (typeof dd.tmax === "number") ? Math.round(dd.tmax) : "‚Äî";
          const tmin = (typeof dd.tmin === "number") ? Math.round(dd.tmin) : "‚Äî";
          return `
            <div class="dayCard ${active}" data-date="${dt}">
              <div class="dayName">${wday}</div>
              <div class="dayEmoji">${emo}</div>
              <div class="dayTemps"><b>${tmax}¬∞</b> / ${tmin}¬∞</div>
            </div>
          `;
        }).join("")}
      </div>
    ` : "");

    const controls = `
      <div class="row" style="margin-top:0;">
        <div class="pill">Date</div>
        <input id="datePick" type="date" value="${state.date || ""}" min="${minDate}" max="${maxDate}">
      </div>
      ${dailyStrip}
    `;

    if (!day){
      body.innerHTML = `
        <div class="muted">Forecast (Open-Meteo)</div>
        ${controls}
        <div class="hint" style="margin-top:10px;">No forecast for this date (try another).</div>
      `;
      wireForecastEvents();
      return;
    }

    const base = weatherCodeToText(day.code);
    const emoji = weatherCodeToEmoji(day.code);

    const hours = pickHourlyForDate(d.hourly, day.date);
    const hourlyHtml = renderHourlyForecast(hours);

    body.innerHTML = `
      <div class="muted">Forecast (Open-Meteo)</div>
      ${controls}

      <div class="row" style="margin-top:10px;">
        <div class="pill">${emoji} ${base}</div>
        <div class="pill">Min: ${Math.round(day.tmin)}¬∞C</div>
        <div class="pill">Max: ${Math.round(day.tmax)}¬∞C</div>
      </div>

      <div class="row" style="margin-top:8px;">
        <div class="pill">Precip: ${day.precip ?? "n/a"} mm</div>
        <div class="pill">Snow: ${day.snow ?? "n/a"} cm</div>
        <div class="pill">Wind max: ${day.windMax ?? "n/a"} km/h</div>
      </div>

      <div class="divider"></div>
      <div class="hint">Tip: date affects outfit temperature suggestion.</div>

      ${hourlyHtml}
    `;

    wireForecastEvents();
  }

  async function updateWeatherFor(loc){
    renderPanelLoading();
    try{
      const data = await getWeather(loc.lat, loc.lon, getDatePickerValue());
      if (selectedLocationId !== loc.id) return;

      LAST_WEATHER_DATA = data;
      const sel = getDatePickerValue();
      const today = new Date().toISOString().slice(0,10);
      if (sel === today && data?.current_weather?.temperature != null){
        setTempBig(data.current_weather.temperature);
      } else {
        const dsel = pickSelectedDayFromDaily(data.daily, sel);
        if (dsel) setTempBig((dsel.tmin + dsel.tmax)/2);
      }


      const dailyTimes = data.daily?.time || [];
      const cwDay = data.current_weather?.time?.slice(0,10);

      state.date = state.date || cwDay || (dailyTimes[0] ?? null);
      if (dailyTimes.length && state.date && !dailyTimes.includes(state.date)) state.date = dailyTimes[0];

      const day = state.date ? pickDailyByDate(data.daily, state.date) : null;
      renderForecastMini(day, dailyTimes);
      if (day && typeof day.tmin === "number" && typeof day.tmax === "number") {
        state.tempC = Math.round((day.tmin + day.tmax) / 2);
        const range = document.getElementById("tempRange");
        if (range) range.value = state.tempC;
        saveSelection({ tmin: day.tmin, tmax: day.tmax });
}
    }catch(e){
      console.error(e);
      const headlineEl = document.getElementById('weatherHeadline');
      const nowTempEl = document.getElementById('weatherNowTemp');
      const gridEl = document.getElementById('weekGrid');
      const statsEl = document.getElementById('dayStats');
      const detailsSummaryEl = document.getElementById('dayDetailsSummary');
      const detailsInnerEl = document.getElementById('dayDetailsInner');
      const detailsEl = document.getElementById('dayDetails');

      if (nowTempEl) nowTempEl.textContent = '‚Äî';
      if (headlineEl) headlineEl.textContent = 'Couldn‚Äôt load Open‚ÄëMeteo.';
      if (gridEl) gridEl.innerHTML = '';
      if (detailsSummaryEl) detailsSummaryEl.textContent = 'Open‚ÄëMeteo error';
      if (statsEl) statsEl.textContent = (e && e.message) ? e.message : 'Request failed';
      if (detailsInnerEl) detailsInnerEl.innerHTML = '<div class="muted">Try refresh (Ctrl+F5). If it still fails, check Network/Console.</div>';
      if (detailsEl) detailsEl.open = true;
      destroyChart();
    }
  }

  function renderLocation(loc){
  selectedLocationId = loc.id;
  CURRENT_LOC = loc;

  // Update Step 1 + Step 2 UI (never throw)
  try{ updateGuidedSelectionUI(loc); }catch(e){ console.error("updateGuidedSelectionUI", e); }

  // Persist selection for gear.html
  try{ saveSelection(); }catch(e){ console.error("saveSelection", e); }

  // Auto-load forecast (Open-Meteo) + paint Step 2 weekly panel
  try{
    if (!getDatePickerValue()) setDatePickerValue(new Date().toISOString().slice(0,10));
    state.date = getDatePickerValue();
    updateWeatherFor(loc);
  }catch(e){ console.error("updateWeatherFor", e); }

  try{ updateReadinessUI(); }catch(e){}
}

  
  
  // ========= Guided Journey UI (Step 1 -> Step 2) =========
  function updateGuidedSelectionUI(loc){
    const label = document.getElementById("selectedMountainLabel");
    if (label) label.textContent = loc ? `Selected: ${loc.name}` : "No mountain selected yet.";

    const hint = document.getElementById("forecastHint");
    if (hint){
      hint.textContent = loc
        ? `Selected: ${loc.name}. Choose a day below.`
        : "Pick a mountain to load forecast.";
    }

    // Make Step 2 button feel alive once we have a location
        if (typeof openBtn !== 'undefined' && openBtn){
      openBtn.disabled = !loc;
      openBtn.style.opacity = loc ? "1" : ".55";
      openBtn.style.cursor = loc ? "pointer" : "not-allowed";
    }

    // Also update the summary line (Step 4)
    const summaryLine = document.getElementById("summaryLine");
    if (summaryLine){
      summaryLine.textContent = loc
        ? `We‚Äôll carry ${loc.name} and the selected temperature into Gear Finder.`
        : "We‚Äôll carry your destination and temperature into Gear Finder.";
    }
  }

  // --- Chart (hourly) ---
  let __weatherChart = null;
  let __metric = 'temp';

  function destroyChart(){
    try{ __weatherChart?.destroy(); }catch(e){}
    __weatherChart = null;
  }

  function wireChartTabs(){
    const tabs = document.getElementById('chartTabs');
    if (!tabs || tabs.__wired) return;
    tabs.__wired = true;
    tabs.querySelectorAll('button[data-metric]').forEach(btn => {
      btn.addEventListener('click', () => {
        __metric = btn.getAttribute('data-metric') || 'temp';
        tabs.querySelectorAll('.tabBtn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderChartForSelected();
      });
    });
  }

  function hourlyForDate(dateStr){
    const h = LAST_WEATHER_DATA?.hourly;
    if (!h?.time?.length) return { labels: [], temp: [], precip: [], wind: [], pprob: [] };
    const labels=[]; const temp=[]; const precip=[]; const wind=[]; const pprob=[];
    for (let i=0;i<h.time.length;i++){
      const t = h.time[i];
      if (!t || !t.startsWith(dateStr)) continue;
      labels.push(t.slice(11,16));
      temp.push(h.temperature_2m?.[i]);
      precip.push(h.precipitation?.[i]);
      wind.push(h.windspeed_10m?.[i]);
      pprob.push(h.precipitation_probability?.[i]);
    }
    return { labels, temp, precip, wind, pprob };
  }

  function renderChartForSelected(){
    const canvas = document.getElementById('weatherChart');
    if (!canvas || !LAST_WEATHER_DATA) return;

    const dateStr = state.date || LAST_WEATHER_DATA?.daily?.time?.[0];
    if (!dateStr) return;
    const hh = hourlyForDate(dateStr);
    if (!hh.labels.length){
      destroyChart();
      return;
    }

    let series = hh.temp;
    let label = 'Temperature (¬∞C)';
    let type = 'line';

    if (__metric === 'precip'){
      series = hh.precip;
      label = 'Precipitation (mm)';
      type = 'bar';
    } else if (__metric === 'wind'){
      series = hh.wind;
      label = 'Wind (km/h)';
      type = 'line';
    }

    const data = {
      labels: hh.labels,
      datasets: [{
        label,
        data: series,
        tension: 0.35,
        pointRadius: 0,
        borderWidth: 2,
      }]
    };

    const opts = {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: { intersect: false, mode: 'index' }
      },
      scales: {
        x: { grid: { display: false } },
        y: { grid: { color: 'rgba(8,25,54,.08)' }, ticks: { maxTicksLimit: 5 } }
      }
    };

    // size fix
    canvas.parentElement.style.height = '180px';

    if (__weatherChart){
      __weatherChart.config.type = type;
      __weatherChart.data = data;
      __weatherChart.options = opts;
      __weatherChart.update();
      return;
    }

    __weatherChart = new Chart(canvas.getContext('2d'), {
      type,
      data,
      options: opts
    });
  }

  function renderForecastMini(day, dailyTimes){
    const hasLoc = !!CURRENT_LOC;
    const nowTempEl = document.getElementById("weatherNowTemp");
    const headlineEl = document.getElementById("weatherHeadline");
    const gridEl = document.getElementById("weekGrid");
    const detailsEl = document.getElementById("dayDetails");
    const detailsSummaryEl = document.getElementById("dayDetailsSummary");
    const statsEl = document.getElementById("dayStats");

    const clearAll = () => {
      if (nowTempEl) nowTempEl.textContent = "‚Äî";
      if (headlineEl) headlineEl.textContent = "Pick a mountain ‚Äî forecast will appear automatically.";
      if (gridEl) gridEl.innerHTML = "";
      if (detailsSummaryEl) detailsSummaryEl.textContent = "Select a day to view charts.";
      if (statsEl) statsEl.textContent = "‚Äî";
      if (detailsEl) detailsEl.open = false;
      destroyChart();
    };

    if (!hasLoc || !LAST_WEATHER_DATA?.daily?.time?.length){
      clearAll();
      return;
    }

    const times = (dailyTimes || LAST_WEATHER_DATA.daily.time || []).slice(0, 7);
    if (!times.length){
      clearAll();
      if (headlineEl) headlineEl.textContent = "No daily forecast available.";
      return;
    }

    // choose date
    if (!state.date || !times.includes(state.date)) state.date = times[0];
    const chosen = pickDailyByDate(LAST_WEATHER_DATA.daily, state.date) || day || pickDaily(LAST_WEATHER_DATA.daily, 0);

    // header similar to Google widget
    const cur = LAST_WEATHER_DATA.current_weather;
    const curDay = cur?.time?.slice(0,10);
    const curTemp = (typeof cur?.temperature === 'number') ? Math.round(cur.temperature) : null;
    // Big number: show current temp only for today's date; otherwise show selected-day average
    if (nowTempEl){
      if (state.date && curDay && state.date === curDay && curTemp != null){
        nowTempEl.textContent = `${curTemp}¬∞C`;
      } else if (chosen && typeof chosen.tmin === 'number' && typeof chosen.tmax === 'number'){
        nowTempEl.textContent = `${Math.round((chosen.tmin + chosen.tmax)/2)}¬∞C`;
      } else {
        nowTempEl.textContent = '‚Äî';
      }
    }

    const headline = `${CURRENT_LOC.name} ¬∑ ${Math.round(chosen.tmin)}¬∞ / ${Math.round(chosen.tmax)}¬∞ ¬∑ ${weatherCodeToText(chosen.code)}`;
    if (headlineEl) headlineEl.textContent = headline;

    // build weekly cards
    if (gridEl){
      gridEl.innerHTML = times.map((dt) => {
        const dd = pickDailyByDate(LAST_WEATHER_DATA.daily, dt);
        const d = new Date(dt + 'T00:00:00');
        const dayName = d.toLocaleDateString('en-US', { weekday: 'short' });
        const label = dt.slice(5); // MM-DD
        const emo = weatherCodeToEmoji(dd?.code);
        const tmax = (typeof dd?.tmax === 'number') ? Math.round(dd.tmax) : '‚Äî';
        const tmin = (typeof dd?.tmin === 'number') ? Math.round(dd.tmin) : '‚Äî';
        const active = (dt === state.date) ? 'active' : '';
        return `
          <div class="dayCard ${active}" data-date="${dt}" role="button" tabindex="0">
            <div class="dayName">${dayName}</div>
            <div class="dayIcon">${emo}</div>
            <div class="dayTemps">${tmax}¬∞ <span>${tmin}¬∞</span></div>
            <div class="muted" style="font-size:11px;margin-top:2px;opacity:.7;">${label}</div>
          </div>`;
      }).join('');

      // wire cards
      gridEl.querySelectorAll('.dayCard').forEach(card => {
        const pick = () => {
          const dt = card.getAttribute('data-date');
          if (!dt) return;
          state.date = dt;
          try{ setDatePickerValue(state.date); }catch(e){}
          try{ setDatePickerValue(dt); }catch(e){}
          const ch = pickDailyByDate(LAST_WEATHER_DATA.daily, dt);
          if (ch){
            state.tempC = Math.round((ch.tmin + ch.tmax) / 2);
            try{ saveSelection({ tmin: ch.tmin, tmax: ch.tmax }); }catch(e){}
            try{ if (typeof updateSetupUI === 'function') updateSetupUI(); }catch(e){}
          }
          if (ch) setTempBig((ch.tmin + ch.tmax)/2);
          renderForecastMini(ch, times);
          updateReadinessUI();
          if (detailsEl) detailsEl.open = true;
          renderChartForSelected();
        };
        card.addEventListener('click', pick);
        card.addEventListener('keydown', (ev) => {
          if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); pick(); }
        });
      });
    }

    // details summary + stats
    if (detailsSummaryEl) detailsSummaryEl.textContent = `${CURRENT_LOC.name} ¬∑ ${state.date}`;
    if (statsEl && chosen){
      const wind = (typeof chosen.windMax === "number") ? `${Math.round(chosen.windMax)} km/h` : "‚Äî";
      const precip = (typeof chosen.precip === "number") ? `${chosen.precip.toFixed(1)} mm` : "‚Äî";
      const snow = (typeof chosen.snow === "number") ? `${chosen.snow.toFixed(1)} cm` : "‚Äî";
      statsEl.innerHTML = `Selected day: <b>${chosen.date}</b><br>Wind max: <b>${wind}</b> ‚Ä¢ Precip: <b>${precip}</b> ‚Ä¢ Snow: <b>${snow}</b>`;
    }

    // ensure tabs wired
    wireChartTabs();
    renderChartForSelected();
  }

  function updateReadinessUI(){
    const pct = document.getElementById("readyPct");
    const sub = document.getElementById("readySub");
    const bar = document.getElementById("readyBar");

    const hasLoc = !!CURRENT_LOC;
    const hasDay = !!state.date;

    let score = 0;
    if (hasLoc) score += 50;
    if (hasDay) score += 50;

    if (pct) pct.textContent = `${score}%`;
    if (sub) sub.textContent = (score === 100)
      ? `Destination: ${CURRENT_LOC.name} ‚Ä¢ Day: ${state.date} ‚Ä¢ Temp: ${state.tempC}¬∞C`
      : "Select destination + day to calculate.";
    if (bar) bar.style.width = `${Math.max(5, score)}%`;
  }

// ========= MAP SEARCH (UI) =========
  const MARKER_BY_ID = new Map();

  function normStr(s){
    return (s || "")
      .toString()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "");
  }

  function setSearchOpen(open){
    const box = document.getElementById("mapSearch");
    if (!box) return;
    box.classList.toggle("collapsed", !open);
    if (open){
      const inp = document.getElementById("mapSearchInput");
      if (inp) setTimeout(() => inp.focus(), 0);
    }
  }

  function renderSearchResults(qRaw){
    const q = normStr(qRaw).trim();
    const resultsEl = document.getElementById("mapSearchResults");
    if (!resultsEl) return;

    if (!q){
      resultsEl.innerHTML = `<div class="mapSearchItem"><span>Type to search by mountain name or region‚Ä¶</span></div>`;
      return;
    }

    const hits = (LOCATIONS || []).filter(l => {
      const hay = normStr(`${l.name} ${l.region} ${l.country}`);
      return hay.includes(q);
    }).slice(0, 10);

    if (!hits.length){
      resultsEl.innerHTML = `<div class="mapSearchItem"><span>No matches.</span></div>`;
      return;
    }

    resultsEl.innerHTML = hits.map(l => `
      <div class="mapSearchItem" data-id="${l.id}">
        <b>${l.name}</b>
        <span>${l.region}, ${l.country}</span>
      </div>
    `).join("");

    resultsEl.querySelectorAll(".mapSearchItem[data-id]").forEach(node => {
      node.addEventListener("click", () => {
        const id = node.getAttribute("data-id");
        const loc = (LOCATIONS || []).find(x => String(x.id) === String(id));
        if (!loc) return;

        // Select location (updates hero + forecast + outfit)
        renderLocation(loc);

        // Move map + open popup
        const m = MARKER_BY_ID.get(String(loc.id));
        map.setView([loc.lat, loc.lon], Math.max(map.getZoom(), 12), { animate:true });

        // MarkerCluster: make sure marker becomes visible before opening popup
        if (m && markersLayer && typeof markersLayer.zoomToShowLayer === "function"){
          markersLayer.zoomToShowLayer(m, () => m.openPopup());
        } else if (m){
          m.openPopup();
        }
// Keep input text + close panel (nice on mobile)
        const inp = document.getElementById("mapSearchInput");
        if (inp) inp.value = loc.name;
        setSearchOpen(false);
      });
    });
  }

  function wireMapSearch(){
    const btn = document.getElementById("mapSearchBtn");
    const inp = document.getElementById("mapSearchInput");
    const box = document.getElementById("mapSearch");

    if (!btn || !inp || !box) return;

    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      const isCollapsed = box.classList.contains("collapsed");
      setSearchOpen(isCollapsed);
      renderSearchResults(inp.value);
    });

    inp.addEventListener("input", () => renderSearchResults(inp.value));

    // Close when clicking outside
    document.addEventListener("click", (e) => {
      if (!box.contains(e.target)) setSearchOpen(false);
    });

    // First paint
    renderSearchResults("");
  }


// ========= MARKERS =========
  let LOCATIONS = [];
  function addMarkers(){
    markersLayer.clearLayers();
    MARKER_BY_ID.clear();

    LOCATIONS.forEach(loc => {
      const m = L.marker([loc.lat, loc.lon]);
      m.bindPopup(`<b>${loc.name}</b><br>${loc.region}, ${loc.country}`);
      m.on("click", () => renderLocation(loc));
      markersLayer.addLayer(m);

      // for search ‚Üí quick focus + popup
      MARKER_BY_ID.set(String(loc.id), m);
    });
  }

  // ========= INIT =========
  try{ wireSetupControls(); }catch(err){ console.warn('wireSetupControls failed (non-fatal):', err); }

    // Layout editor wiring (button + panel) after DOM is ready
    window.addEventListener('DOMContentLoaded', () => {
      try { wireLayoutEditor(); } catch (e) { console.warn(e); }
    });

  (async () => {
    try{
      LOCATIONS = await loadLocations();
      addMarkers();
      wireMapSearch();
      const bounds = L.latLngBounds(LOCATIONS.map(l => [l.lat, l.lon]));
      map.fitBounds(bounds.pad(0.2));
      setTimeout(() => map.invalidateSize(), 200);
    }catch(e){
      console.error(e);
      console.error("Locations load error:", e);
      const label = document.getElementById('selectedMountainLabel');
      if (label) label.textContent = 'Error loading locations. Check data/locations.geojson.';
      alert('Error loading locations. Check data/locations.geojson');
    }
  })();

  function wireGuidedStepButtons(){  const autoBtn = document.getElementById("btnAutoPickDay");

  // No auto-scroll. Button is just a helper hint (optional).
  autoBtn?.addEventListener("click", () => {
    if (!LAST_WEATHER_DATA?.daily?.time?.length) return;
    const times = LAST_WEATHER_DATA.daily.time;
    const today = LAST_WEATHER_DATA.current_weather?.time?.slice(0,10);
    state.date = (today && times.includes(today)) ? today : times[0];
    const chosen = pickDailyByDate(LAST_WEATHER_DATA.daily, state.date);
    if (chosen){
      state.tempC = Math.round((chosen.tmin + chosen.tmax) / 2);
      saveSelection({ tmin: chosen.tmin, tmax: chosen.tmax });
}
    renderForecastMini(chosen, times);
    updateReadinessUI();

  const dp = document.getElementById('datePicker');
  // init date input
  if (dp && !dp.value) dp.value = new Date().toISOString().slice(0,10);
  dp?.addEventListener('change', () => {
    if (!CURRENT_LOC) return;
    state.date = getDatePickerValue();
    updateWeatherFor(CURRENT_LOC);
  });
}
);

  // initial state
  updateGuidedSelectionUI(null);
  updateReadinessUI();
}

window.addEventListener("DOMContentLoaded", wireGuidedStepButtons);
// First paint avatar
  applyOutfit();
  updateAvatarScale();
</script>

  <!-- ===== LAYOUT EDITOR (toggle button) ===== -->
  <button id="layoutEditBtn" class="layoutEditBtn" type="button" title="Edit outfit positions (dev tool)">
    üõ† Layout editor
  </button>

  <div id="layoutEditPanel" class="layoutEditPanel" aria-hidden="true">
    <div class="layoutEditHeader">
      <div class="layoutEditTitle">Outfit layout editor</div>
      <button id="layoutEditClose" class="layoutEditClose" type="button" aria-label="Close">‚úï</button>
    </div>

    <div class="layoutEditBody">
      <div class="layoutEditRow">
        <label class="layoutEditLabel">Item</label>
        <select id="layoutEditSelect" class="layoutEditSelect"></select>
      </div>

      <div class="layoutEditGrid">
        <div class="layoutEditField">
          <label class="layoutEditLabel">x</label>
          <input id="layoutEditX" type="number" step="1" class="layoutEditInput">
        </div>
        <div class="layoutEditField">
          <label class="layoutEditLabel">y</label>
          <input id="layoutEditY" type="number" step="1" class="layoutEditInput">
        </div>
        <div class="layoutEditField">
          <label class="layoutEditLabel">r (deg)</label>
          <input id="layoutEditR" type="number" step="0.1" class="layoutEditInput">
        </div>
        <div class="layoutEditField">
          <label class="layoutEditLabel">z</label>
          <input id="layoutEditZ" type="number" step="1" class="layoutEditInput">
        </div>
      </div>

      <div class="layoutEditHint">
        Tip: change values ‚Üí it updates live. When you're happy, click ‚ÄúCopy POS JSON‚Äù and paste it back into the file (const POS = {...}).
      </div>

      <div class="layoutEditActions">
        <button id="layoutEditCopy" class="layoutEditActionBtn" type="button">Copy POS JSON</button>
        <button id="layoutEditReset" class="layoutEditActionBtn ghost" type="button">Reset</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</body>
</html>























































































































